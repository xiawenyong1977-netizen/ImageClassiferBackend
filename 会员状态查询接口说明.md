# 会员状态查询接口说明

## 新增接口

### 1. `/api/v1/user/member-status` - 查询会员状态

**方法**: GET

**请求头**:
```
X-WeChat-OpenID: xxx
```

**响应**:
```json
{
    "success": true,
    "is_member": true,
    "member_expire_at": "2025-11-28 11:25:00",
    "data": {
        "is_member": 1,
        "member_expire_at": "2025-11-28 11:25:00",
        "created_at": "2025-10-29 10:00:00"
    }
}
```

### 2. `/api/v1/user/credits` - 增强版查询用户信息

原有接口已增强，现在会返回会员状态信息：

**方法**: GET

**请求头**:
```
X-WeChat-OpenID: xxx
```

**响应**:
```json
{
    "success": true,
    "data": {
        "total_credits": 10,
        "used_credits": 0,
        "remaining_credits": 10,
        "is_member": 1,
        "member_expire_at": "2025-11-28 11:25:00",
        "created_at": "2025-10-29 10:00:00",
        "last_active_time": "2025-10-29 11:25:00"
    }
}
```

## 当前实现

member.html 页面现在会：
1. 获取授权获取 openid
2. 调用 `/api/v1/user/credits` 查询用户信息（包含会员状态）
3. 根据会员状态动态渲染页面：
   - **会员用户**：显示"终身会员"、"已激活状态"、会员权限、查看额度按钮
   - **非会员用户**：显示"开通会员"、会员权限、价格、立即开通按钮

## 测试接口

可以使用 curl 测试：

```bash
curl -H "X-WeChat-OpenID: your_openid" \
  http://www.xintuxiangce.top/api/v1/user/member-status
```

## 相关文件

- `app/api/user.py` - 用户管理接口
- `web/member.html` - 会员开通页面
- `web/credits_info.html` - 额度查询页面

