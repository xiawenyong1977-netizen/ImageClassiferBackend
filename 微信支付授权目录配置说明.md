# 微信支付授权目录配置说明

## 错误信息

```
当前页面的URL未注册：https://www.xintuxiangce.top/member.html
```

## 问题原因

微信支付的 **JSAPI支付** 需要在微信支付商户后台配置 **"支付授权目录"**。如果不配置，会出现上述错误。

## 解决方案

### 1. 登录微信支付商户平台

访问：https://pay.weixin.qq.com/

使用商户号和管理员账号登录。

### 2. 配置支付授权目录

#### 路径一：通过产品中心配置

1. 进入 **"产品中心"** → **"开发配置"** → **"支付配置"** → **"JSAPI支付"**
2. 找到 **"JSAPI支付域名"** 或 **"支付授权目录"** 配置项
3. 点击 **"设置"** 或 **"添加"**
4. 添加授权目录：
   ```
   https://xgzwww.xintuxiangce.top/
   ```
   **重要说明：**
   - 必须以 `/` 结尾
   - 只能填域名部分，不要包含具体文件路径
   - 例如：`https://www.xintuxiangce.top/` ✅
   - 错误：`https://www.xintuxiangce.top/member.html` ❌

#### 路径二：通过商户平台直接配置

1. 进入 **"账户中心"** → **"API安全"** → **"支付授权目录"**
2. 点击 **"添加"**
3. 输入授权目录：
   ```
   https://www.xintuxiangce.top/
   ```
4. 点击 **"确定"** 保存

### 3. 配置说明

**支付授权目录的配置规则：**

- 只填写域名和路径前缀，以 `/` 结尾
- 支持三级或三级以上的路径
- 例如：`https://www.xintuxiangce.top/` 表示允许所有子目录

**实际生效的页面：**
- ✅ `https://www.xintuxiangce.top/member.html`
- ✅ `https://www.xintuxiangce.top/credits.html`
- ✅ `https://www.xintuxiangce.top/credits_info.html`
- ✅ `https://www.xintuxiangce.top/any/path/page.html`

**不生效的情况：**
- ❌ `https://www.xintuxiangce.top`（没有斜杠）
- ❌ 其他域名下的页面

### 4. 验证配置

配置完成后：

1. 等待 5-10 分钟让配置生效
2. 在微信中打开公众号菜单"开通会员"
3. 点击"立即开通"
4. 此时不应再显示"当前页面的URL未注册"错误
5. 应该能正常调起微信支付

## 其他需要配置的项目

除了支付授权目录，还需要配置：

### 1. 支付回调URL（已配置）

用于接收微信支付成功后的异步通知：
```
https://www.xintuxiangce.top/api/v1/payment/notify
```

### 2. 授权回调域名（已配置）

用于微信公众号网页授权：
```
www.xintuxiangce.top
```

### 3. 支付域名白名单（如有）

某些情况下需要在安全域名中配置：
```
www.xintuxiangce.top
```

## 配置总结

在微信支付商户后台需要配置两个URL：

| 配置项 | 用途 | URL格式 | 示例 |
|--------|------|---------|------|
| **支付授权目录** | JSAPI支付页面授权 | `https://域名/` | `https://www.xintuxiangce.top/` |
| **支付回调URL** | 接收支付通知 | `https://域名/路径` | `https://www.xintuxiangce.top/api/v1/payment/notify` |

## 常见问题

### Q1: 配置后还是提示未注册？

**A:** 检查以下几点：
1. URL格式是否正确（必须以 `/` 结尾）
2. 配置是否已保存
3. 等待 5-10 分钟让配置生效
4. 清除微信缓存后重试

### Q2: 可以配置多个授权目录吗？

**A:** 可以，最多配置 5 个支付授权目录。如果需要更多页面，可以配置更高级别的目录。

### Q3: 配置授权目录会影响安全性吗？

**A:** 不会。授权目录只是告诉微信哪些页面可以调起支付，不会带来安全风险。

### Q4: 配置后如何测试？

**A:** 
1. 先在测试环境配置测试授权目录
2. 使用微信测试号测试支付流程
3. 确认无误后再配置生产环境的授权目录

## 配置截图示例

由于无法提供实时截图，配置时的关键点：

```
支付授权目录设置
┌─────────────────────────────────────────┐
│ 添加授权目录                              │
├─────────────────────────────────────────┤
│ URL: https://www.xintuxiangce.top/      │
│                                         │
│ [取消]  [确定]                          │
└─────────────────────────────────────────┘
```

## 技术支持

如遇到配置问题，可以：
1. 查看微信支付开发文档：https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml
2. 联系微信支付客服：95017
3. 查看本文档：`微信支付配置指南.md`

## 相关文档

- `微信支付配置指南.md` - 完整的微信支付配置说明
- `支付回调配置检查.md` - 支付回调URL配置说明
- `微信公众号菜单配置.md` - 公众号菜单配置说明

