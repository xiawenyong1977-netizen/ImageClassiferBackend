# 微信配置检查清单

## 🔍 问题排查

### 1. 检查Token配置
服务器上的 Token: `Zywl2025`

**请在微信公众平台确认：**
- 进入「开发」-「基本配置」
- 检查「Token」字段是否为 `Zywl2025`
- 如果不一致，请修改为 `Zywl2025`

### 2. 检查消息加密模式
**必须选择：明文模式**

如果在微信公众平台配置时选择了：
- ❌ **兼容模式** - 可能出错
- ❌ **安全模式** - 可能出错  
- ✅ **明文模式** - 这是正确的

### 3. 检查URL配置
服务器URL应该配置为：
```
https://admin.xintuxiangce.top/api/v1/auth/wechat/verify
```

**注意：**
- ✅ 使用 HTTPS
- ✅ 不需要端口号
- ✅ 路径完整：`/api/v1/auth/wechat/verify`

### 4. 测试接口
从微信公众平台点击「提交」后，会向服务器发送GET请求验证。

**如何验证接口是否正常：**
```bash
# 在服务器上测试
curl 'http://localhost:8000/api/v1/auth/wechat/verify?signature=test&timestamp=123&nonce=456&echostr=hello'
# 应该返回: {"detail":"验证失败"}
# 这是正常的，因为测试参数不匹配
```

### 5. 查看日志
```bash
ssh root@123.57.68.4 "tail -f /tmp/app.log"
```

提交配置时，应该能看到类似日志：
```
INFO: 微信服务器验证失败: signature=xxx, hashcode=xxx
```

### 6. 常见错误及解决

#### 错误1：验证失败
- **原因**：Token不匹配
- **解决**：确保微信后台的Token是 `Zywl2025`

#### 错误2：非200状态
- **原因**：可能是加密模式选择错误
- **解决**：选择明文模式

#### 错误3：网络问题
- **原因**：微信无法访问服务器
- **解决**：确保服务器可以从外网访问，检查防火墙

### 7. 重新配置步骤

1. 登录微信公众平台
2. 进入「开发」-「基本配置」
3. 点击「修改配置」
4. 填写：
   - **URL**: `https://admin.xintuxiangce.top/api/v1/auth/wechat/verify`
   - **Token**: `Zywl2025`
   - **EncodingAESKey**: 留空
   - **消息加解密方式**: 选择 **明文模式**
5. 点击「提交」

### 8. 验证成功标志

如果看到以下信息，说明配置成功：
- ✅ "配置成功"
- ✅ "服务器配置已启用"

### 9. 如果还是失败

请提供以下信息以便排查：
1. 微信公众平台返回的具体错误信息
2. 服务器日志内容
3. 配置时的截图
