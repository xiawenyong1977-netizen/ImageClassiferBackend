# rsync双向同步说明

## 📋 rsync特性

**rsync本身是单向同步工具**，它只能从一个源同步到目标，不能自动双向同步。

但是可以通过以下方式实现双向同步：

---

## 🔄 双向同步方案

### 方案1：使用两个rsync命令（推荐）

分别在两个服务器上配置定时任务，实现双向同步：

```
Web服务器 ←→ App服务器
    ↓           ↓
 定时任务1   定时任务2
(Web→App)   (App→Web)
```

**优点**：
- ✅ 使用标准rsync，无需额外工具
- ✅ 配置简单
- ✅ 可靠性高

**缺点**：
- ⚠️ 可能产生冲突（如果两边同时修改同一文件）
- ⚠️ 需要协调同步时间，避免冲突

### 方案2：使用专门的双向同步工具

推荐工具：
- **unison** - 真正的双向同步工具
- **lsyncd** - 实时同步工具
- **syncthing** - P2P同步工具

**优点**：
- ✅ 自动处理冲突
- ✅ 真正的双向同步
- ✅ 实时同步

**缺点**：
- ⚠️ 需要安装额外软件
- ⚠️ 配置相对复杂

---

## 💡 推荐方案

根据您的场景（**Web为主，App为从**），建议：

### 场景1：单向同步（推荐）

如果images目录主要在Web服务器上生成，App服务器只需要读取：

```
Web服务器（主） → App服务器（从）
```

**使用现有的 `sync-images.sh` 脚本即可**

### 场景2：需要双向同步

如果App服务器也会生成图片，需要同步回Web服务器：

```
Web服务器 ←→ App服务器
```

**使用双向同步脚本**（见下文）

---

## ⚠️ 双向同步注意事项

1. **冲突处理**：如果两边同时修改同一文件，后同步的会覆盖先同步的
2. **同步顺序**：建议错开同步时间，避免同时执行
3. **文件锁定**：无法自动处理文件锁定，需要应用层处理
4. **数据一致性**：需要确保应用层不会在两边同时写入同一文件

---

## 🎯 建议

根据您的架构（Web为主，App为从），**建议使用单向同步**：

- Web服务器生成images → 同步到App服务器
- App服务器只读images，不写入

这样可以：
- ✅ 避免冲突
- ✅ 数据一致性更好
- ✅ 配置更简单

如果需要双向同步，请使用下面提供的双向同步脚本。

