# æ–°ECSæœåŠ¡å™¨éƒ¨ç½²è¯„ä¼°æ¸…å•

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

**ç›®æ ‡æœåŠ¡å™¨**: æ–°ECSæœåŠ¡å™¨ï¼ˆå¯é€šè¿‡ `ssh root@app` ç™»å½•ï¼‰  
**é¡¹ç›®**: ImageClassifierBackend - å›¾ç‰‡åˆ†ç±»åç«¯ç³»ç»Ÿ  
**æŠ€æœ¯æ ˆ**: Python 3.10+, FastAPI, MySQL 8.0+, Gunicorn

---

## âœ… éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### 1. æœåŠ¡å™¨ç¯å¢ƒæ£€æŸ¥
- [ ] ç¡®è®¤æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼ˆæ¨è Ubuntu 20.04/22.04 æˆ– CentOS 7/8ï¼‰
- [ ] ç¡®è®¤æœåŠ¡å™¨é…ç½®ï¼ˆå»ºè®® 2æ ¸4GB ä»¥ä¸Šï¼‰
- [ ] ç¡®è®¤å…¬ç½‘IPå’ŒåŸŸåï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] ç¡®è®¤SSHå…å¯†ç™»å½•å·²é…ç½®ï¼ˆ`ssh root@app` å¯æ­£å¸¸ç™»å½•ï¼‰

### 2. ç½‘ç»œå’Œç«¯å£
- [ ] ç¡®è®¤é˜²ç«å¢™è§„åˆ™ï¼ˆéœ€è¦å¼€æ”¾ç«¯å£ï¼š22, 8000, 80, 443ï¼‰
- [ ] ç¡®è®¤é˜¿é‡Œäº‘å®‰å…¨ç»„è§„åˆ™ï¼ˆåœ¨æ§åˆ¶å°é…ç½®ï¼‰
- [ ] ç¡®è®¤åŸŸåè§£æï¼ˆå¦‚æœæœ‰åŸŸåï¼‰

### 3. ç°æœ‰é…ç½®ä¿¡æ¯æ”¶é›†
- [ ] MySQL rootå¯†ç ï¼ˆæˆ–éœ€è¦é‡æ–°è®¾ç½®ï¼‰
- [ ] é˜¿é‡Œäº‘DashScope APIå¯†é’¥ï¼ˆLLM_API_KEYï¼‰
- [ ] å¾®ä¿¡é…ç½®ä¿¡æ¯ï¼ˆAPPID, SECRET, TOKENï¼‰
- [ ] å¾®ä¿¡æ”¯ä»˜é…ç½®ï¼ˆMCHID, API_KEY, NOTIFY_URLï¼‰
- [ ] JWTå¯†é’¥ï¼ˆç”¨äºç®¡ç†åå°è®¤è¯ï¼‰
- [ ] ç®¡ç†å‘˜å¯†ç å“ˆå¸Œ

---

## ğŸš€ éƒ¨ç½²å·¥ä½œæ¸…å•

### é˜¶æ®µä¸€ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

#### 1.1 ç³»ç»Ÿæ›´æ–°å’ŒåŸºç¡€å·¥å…·
```bash
# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
apt install -y git curl wget vim build-essential software-properties-common
```

**é¢„è®¡æ—¶é—´**: 5-10åˆ†é’Ÿ

#### 1.2 å®‰è£…Python 3.10
```bash
# æ·»åŠ deadsnakes PPAï¼ˆUbuntuï¼‰
apt install -y software-properties-common
add-apt-repository ppa:deadsnakes/ppa -y
apt update

# å®‰è£…Python 3.10
apt install -y python3.10 python3.10-venv python3.10-dev

# è®¾ç½®Python 3.10ä¸ºé»˜è®¤ç‰ˆæœ¬
update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 1

# å®‰è£…pip
curl -sS https://bootstrap.pypa.io/get-pip.py | python3.10

# éªŒè¯
python3 --version  # åº”æ˜¾ç¤º Python 3.10.x
pip3 --version
```

**é¢„è®¡æ—¶é—´**: 10-15åˆ†é’Ÿ

#### 1.3 å®‰è£…MySQL 8.0
```bash
# å®‰è£…MySQL
apt install -y mysql-server

# å¯åŠ¨MySQLæœåŠ¡
systemctl start mysql
systemctl enable mysql

# å®‰å…¨é…ç½®ï¼ˆé‡è¦ï¼ï¼‰
mysql_secure_installation
```

**MySQLå®‰å…¨é…ç½®æç¤º**:
1. è®¾ç½®rootå¯†ç ï¼ˆè®°ä½è¿™ä¸ªå¯†ç ï¼ï¼‰
2. ç§»é™¤åŒ¿åç”¨æˆ·ï¼šY
3. ç¦æ­¢rootè¿œç¨‹ç™»å½•ï¼šY
4. ç§»é™¤testæ•°æ®åº“ï¼šY
5. é‡æ–°åŠ è½½æƒé™è¡¨ï¼šY

**é¢„è®¡æ—¶é—´**: 10-15åˆ†é’Ÿ

#### 1.4 é…ç½®MySQLæ•°æ®åº“
```bash
# ç™»å½•MySQL
mysql -u root -p

# åœ¨MySQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
CREATE DATABASE image_classifier DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'classifier'@'localhost' IDENTIFIED BY 'è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ';
GRANT ALL PRIVILEGES ON image_classifier.* TO 'classifier'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

**é¢„è®¡æ—¶é—´**: 5åˆ†é’Ÿ

---

### é˜¶æ®µäºŒï¼šä»£ç éƒ¨ç½²

#### 2.1 ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

**æ–¹æ¡ˆ1ï¼šä½¿ç”¨SCPä¸Šä¼ ï¼ˆæ¨èï¼‰**
```powershell
# åœ¨æœ¬åœ°Windows PowerShellæ‰§è¡Œ
cd D:\ImageClassifierBackend

# æ‰“åŒ…ä»£ç ï¼ˆæ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼‰
tar -czf project.tar.gz --exclude='.git' --exclude='__pycache__' --exclude='venv' --exclude='*.pyc' .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp project.tar.gz root@app:/opt/
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨Gitï¼ˆå¦‚æœä»£ç åœ¨Gitä»“åº“ï¼‰**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /opt
git clone <ä½ çš„Gitä»“åº“URL> ImageClassifierBackend
cd ImageClassifierBackend
```

**æ–¹æ¡ˆ3ï¼šä½¿ç”¨WinSCPï¼ˆGUIå·¥å…·ï¼‰**
- ä¸‹è½½WinSCPï¼šhttps://winscp.net/
- è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆä½¿ç”¨ `app` ä½œä¸ºä¸»æœºåï¼‰
- å°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹æ‹–æ‹½åˆ° `/opt/ImageClassifierBackend`

**é¢„è®¡æ—¶é—´**: 5-15åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

#### 2.2 è§£å‹å’Œè®¾ç½®æƒé™
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /opt
mkdir -p ImageClassifierBackend
tar -xzf project.tar.gz -C ImageClassifierBackend
cd ImageClassifierBackend

# è®¾ç½®æƒé™
chown -R root:root /opt/ImageClassifierBackend
```

**é¢„è®¡æ—¶é—´**: 2åˆ†é’Ÿ

---

### é˜¶æ®µä¸‰ï¼šPythonç¯å¢ƒé…ç½®

#### 3.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
cd /opt/ImageClassifierBackend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å‡çº§pip
pip install --upgrade pip
```

**é¢„è®¡æ—¶é—´**: 2åˆ†é’Ÿ

#### 3.2 å®‰è£…Pythonä¾èµ–
```bash
# å®‰è£…ä¾èµ–ï¼ˆè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯ONNX Runtimeå’ŒUltralyticsï¼‰
pip install -r requirements.txt

# éªŒè¯å®‰è£…
pip list
```

**æ³¨æ„**: 
- `onnxruntime==1.16.3` å’Œ `ultralytics==8.0.200` å®‰è£…æ—¶é—´è¾ƒé•¿
- å¦‚æœç½‘ç»œè¾ƒæ…¢ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›½å†…é•œåƒæº

**é¢„è®¡æ—¶é—´**: 10-30åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

---

### é˜¶æ®µå››ï¼šç¯å¢ƒå˜é‡é…ç½®

#### 4.1 åˆ›å»º.envæ–‡ä»¶
```bash
cd /opt/ImageClassifierBackend

# å¤åˆ¶æ¨¡æ¿
cp env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
# æˆ–ä½¿ç”¨nano
nano .env
```

#### 4.2 é…ç½®å…³é”®ç¯å¢ƒå˜é‡

**å¿…é¡»é…ç½®çš„å˜é‡**:
```ini
# MySQLé…ç½®
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=classifier
MYSQL_PASSWORD=ä½ åœ¨é˜¶æ®µ1.4è®¾ç½®çš„å¯†ç 
MYSQL_DATABASE=image_classifier

# å¤§æ¨¡å‹é…ç½®ï¼ˆé˜¿é‡Œäº‘é€šä¹‰åƒé—®ï¼‰
LLM_PROVIDER=aliyun
LLM_API_KEY=sk-ä½ çš„DashScope-APIå¯†é’¥
LLM_MODEL=qwen-vl-plus
LLM_MAX_TOKENS=500
LLM_TIMEOUT=30

# åº”ç”¨é…ç½®
APP_HOST=0.0.0.0
APP_PORT=8000
APP_DEBUG=false
APP_ENV=production

# å¾®ä¿¡é…ç½®
WECHAT_APPID=wx519901dac7705111
WECHAT_SECRET=ä½ çš„å¾®ä¿¡Secret
WECHAT_TOKEN=ä½ çš„å¾®ä¿¡Token

# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_PAY_MCHID=ä½ çš„å•†æˆ·å·
WECHAT_PAY_API_KEY=ä½ çš„APIå¯†é’¥
WECHAT_PAY_NOTIFY_URL=https://ä½ çš„åŸŸå/api/v1/payment/notify

# ç®¡ç†åå°è®¤è¯
JWT_SECRET_KEY=ç”Ÿæˆä¸€ä¸ªå¼ºéšæœºå¯†é’¥ï¼ˆå¯ç”¨ openssl rand -hex 32 ç”Ÿæˆï¼‰
ADMIN_USERNAME=zywl
ADMIN_PASSWORD_HASH=ä½ çš„ç®¡ç†å‘˜å¯†ç å“ˆå¸Œï¼ˆbcryptæ ¼å¼ï¼‰

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/var/log/image-classifier/app.log
```

**é¢„è®¡æ—¶é—´**: 10-15åˆ†é’Ÿ

---

### é˜¶æ®µäº”ï¼šæ•°æ®åº“åˆå§‹åŒ–

#### 5.1 æ‰§è¡Œåˆå§‹åŒ–SQLè„šæœ¬
```bash
cd /opt/ImageClassifierBackend

# æ‰§è¡Œä¸»åˆå§‹åŒ–è„šæœ¬
mysql -u classifier -p image_classifier < sql/init.sql

# æ‰§è¡Œå…¶ä»–å¿…è¦çš„SQLè„šæœ¬ï¼ˆæ ¹æ®é¡¹ç›®éœ€è¦ï¼‰
# mysql -u classifier -p image_classifier < sql/add_wechat_users.sql
# mysql -u classifier -p image_classifier < sql/add_payment_tables.sql
# ... å…¶ä»–SQLè„šæœ¬
```

#### 5.2 éªŒè¯æ•°æ®åº“è¡¨
```bash
mysql -u classifier -p -e "USE image_classifier; SHOW TABLES;"
```

**åº”è¯¥çœ‹åˆ°çš„ä¸»è¦è¡¨**:
- `image_classification_cache` - åˆ†ç±»ç»“æœç¼“å­˜è¡¨
- `request_log` - è¯·æ±‚æ—¥å¿—è¡¨
- `wechat_users` - å¾®ä¿¡ç”¨æˆ·è¡¨
- `image_edit_tasks` - å›¾åƒç¼–è¾‘ä»»åŠ¡è¡¨
- `payment_records` - æ”¯ä»˜è®°å½•è¡¨
- `user_credits` - ç”¨æˆ·é¢åº¦è¡¨
- ç­‰ç­‰...

**é¢„è®¡æ—¶é—´**: 5åˆ†é’Ÿ

---

### é˜¶æ®µå…­ï¼šæ—¥å¿—ç›®å½•å’Œæƒé™

#### 6.1 åˆ›å»ºæ—¥å¿—ç›®å½•
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /var/log/image-classifier

# è®¾ç½®æƒé™
chown -R root:root /var/log/image-classifier
chmod 755 /var/log/image-classifier
```

**é¢„è®¡æ—¶é—´**: 1åˆ†é’Ÿ

---

### é˜¶æ®µä¸ƒï¼šé˜²ç«å¢™é…ç½®

#### 7.1 é…ç½®UFWé˜²ç«å¢™
```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
ufw status

# å¦‚æœé˜²ç«å¢™æœªå¯ç”¨ï¼Œå¯ç”¨å®ƒ
ufw enable

# å¼€æ”¾SSHç«¯å£ï¼ˆé‡è¦ï¼å¦åˆ™ä¼šæ–­å¼€è¿æ¥ï¼‰
ufw allow 22/tcp

# å¼€æ”¾åº”ç”¨ç«¯å£
ufw allow 8000/tcp

# å¦‚æœè¦ç”¨80/443ç«¯å£ï¼ˆéœ€è¦Nginxï¼‰
ufw allow 80/tcp
ufw allow 443/tcp

# é‡æ–°åŠ è½½é˜²ç«å¢™
ufw reload

# æŸ¥çœ‹çŠ¶æ€
ufw status
```

#### 7.2 é…ç½®é˜¿é‡Œäº‘å®‰å…¨ç»„
**åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°**:
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. æ‰¾åˆ°ä½ çš„ECSå®ä¾‹
3. è¿›å…¥"å®‰å…¨ç»„"è®¾ç½®
4. æ·»åŠ è§„åˆ™ï¼š
   - ç«¯å£ï¼š8000
   - åè®®ï¼šTCP
   - ç­–ç•¥ï¼šå…è®¸
   - æºï¼š0.0.0.0/0ï¼ˆæˆ–æŒ‡å®šIPèŒƒå›´ï¼‰

**é¢„è®¡æ—¶é—´**: 5åˆ†é’Ÿ

---

### é˜¶æ®µå…«ï¼šSystemdæœåŠ¡é…ç½®

#### 8.1 åˆ›å»ºæœåŠ¡æ–‡ä»¶
```bash
vim /etc/systemd/system/image-classifier.service
```

**æœåŠ¡æ–‡ä»¶å†…å®¹**:
```ini
[Unit]
Description=Image Classifier API Service
After=network.target mysql.service

[Service]
Type=notify
User=root
Group=root
WorkingDirectory=/opt/ImageClassifierBackend
Environment="PATH=/opt/ImageClassifierBackend/venv/bin"
ExecStart=/opt/ImageClassifierBackend/venv/bin/gunicorn -c gunicorn_config.py app.main:app
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```

#### 8.2 å¯åŠ¨æœåŠ¡
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start image-classifier

# æŸ¥çœ‹çŠ¶æ€
systemctl status image-classifier

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable image-classifier

# æŸ¥çœ‹æ—¥å¿—
journalctl -u image-classifier -f
```

**é¢„è®¡æ—¶é—´**: 5åˆ†é’Ÿ

---

### é˜¶æ®µä¹ï¼šæµ‹è¯•å’ŒéªŒè¯

#### 9.1 å¥åº·æ£€æŸ¥
```bash
# æœ¬åœ°æµ‹è¯•
curl http://localhost:8000/api/v1/health

# åº”è¯¥è¿”å›ï¼š
# {
#   "status": "healthy",
#   "database": "connected",
#   "model_api": "available"
# }
```

#### 9.2 æµ‹è¯•APIæ–‡æ¡£
- åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000/docs`
- åº”è¯¥èƒ½çœ‹åˆ°FastAPIè‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£é¡µé¢

#### 9.3 æµ‹è¯•åˆ†ç±»æ¥å£
```bash
# å‡†å¤‡ä¸€å¼ æµ‹è¯•å›¾ç‰‡
curl -X POST "http://ä½ çš„æœåŠ¡å™¨IP:8000/api/v1/classify" \
  -H "accept: application/json" \
  -F "image=@test.jpg"
```

#### 9.4 æµ‹è¯•ç»Ÿè®¡æ¥å£
```bash
curl http://ä½ çš„æœåŠ¡å™¨IP:8000/api/v1/stats/today
```

**é¢„è®¡æ—¶é—´**: 10åˆ†é’Ÿ

---

### é˜¶æ®µåï¼šNginxåå‘ä»£ç†ï¼ˆå¯é€‰ä½†æ¨èï¼‰

#### 10.1 å®‰è£…Nginx
```bash
apt install -y nginx
```

#### 10.2 åˆ›å»ºNginxé…ç½®
```bash
vim /etc/nginx/sites-available/image-classifier
```

**Nginxé…ç½®**:
```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸåæˆ–IP;

    client_max_body_size 10M;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 10.3 å¯ç”¨é…ç½®
```bash
# åˆ›å»ºè½¯é“¾æ¥
ln -s /etc/nginx/sites-available/image-classifier /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½Nginx
systemctl reload nginx
```

#### 10.4 é…ç½®HTTPSï¼ˆä½¿ç”¨Let's Encryptï¼‰
```bash
# å®‰è£…certbot
apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
certbot --nginx -d ä½ çš„åŸŸå

# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

**é¢„è®¡æ—¶é—´**: 15-20åˆ†é’Ÿ

---

## ğŸ“Š éƒ¨ç½²æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | å¤‡æ³¨ |
|------|---------|------|
| é˜¶æ®µä¸€ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ | 30-40åˆ†é’Ÿ | åŒ…æ‹¬Pythonå’ŒMySQLå®‰è£… |
| é˜¶æ®µäºŒï¼šä»£ç éƒ¨ç½² | 5-15åˆ†é’Ÿ | å–å†³äºç½‘ç»œé€Ÿåº¦ |
| é˜¶æ®µä¸‰ï¼šPythonç¯å¢ƒé…ç½® | 12-32åˆ†é’Ÿ | ä¾èµ–å®‰è£…å¯èƒ½è¾ƒæ…¢ |
| é˜¶æ®µå››ï¼šç¯å¢ƒå˜é‡é…ç½® | 10-15åˆ†é’Ÿ | éœ€è¦æ”¶é›†é…ç½®ä¿¡æ¯ |
| é˜¶æ®µäº”ï¼šæ•°æ®åº“åˆå§‹åŒ– | 5åˆ†é’Ÿ | |
| é˜¶æ®µå…­ï¼šæ—¥å¿—ç›®å½• | 1åˆ†é’Ÿ | |
| é˜¶æ®µä¸ƒï¼šé˜²ç«å¢™é…ç½® | 5åˆ†é’Ÿ | |
| é˜¶æ®µå…«ï¼šSystemdæœåŠ¡ | 5åˆ†é’Ÿ | |
| é˜¶æ®µä¹ï¼šæµ‹è¯•éªŒè¯ | 10åˆ†é’Ÿ | |
| é˜¶æ®µåï¼šNginxé…ç½®ï¼ˆå¯é€‰ï¼‰ | 15-20åˆ†é’Ÿ | |
| **æ€»è®¡** | **98-143åˆ†é’Ÿ** | çº¦1.5-2.5å°æ—¶ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è¿ç§»ï¼ˆå¦‚æœæœ‰æ—§æœåŠ¡å™¨ï¼‰
- [ ] å¤‡ä»½æ—§æœåŠ¡å™¨æ•°æ®åº“
- [ ] å¯¼å‡ºæ•°æ®åº“æ•°æ®
- [ ] åœ¨æ–°æœåŠ¡å™¨å¯¼å…¥æ•°æ®
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§

### 2. é…ç½®æ–‡ä»¶è¿ç§»
- [ ] ä»æ—§æœåŠ¡å™¨å¤åˆ¶ `.env` æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [ ] æ›´æ–°åŸŸåå’ŒIPç›¸å…³é…ç½®
- [ ] æ›´æ–°å›è°ƒURLï¼ˆå¾®ä¿¡æ”¯ä»˜ç­‰ï¼‰

### 3. æ¨¡å‹æ–‡ä»¶
- [ ] ç¡®è®¤ `app/models/` ç›®å½•ä¸‹çš„ONNXæ¨¡å‹æ–‡ä»¶å·²ä¸Šä¼ 
- [ ] éªŒè¯æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§

### 4. å¾®ä¿¡é…ç½®æ›´æ–°
- [ ] æ›´æ–°å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨URLï¼ˆå¦‚æœåŸŸåæ”¹å˜ï¼‰
- [ ] æ›´æ–°å¾®ä¿¡æ”¯ä»˜å›è°ƒURL
- [ ] æ›´æ–°IPç™½åå•ï¼ˆå¦‚æœæœ‰ï¼‰

### 5. ç›‘æ§å’Œæ—¥å¿—
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] è®¾ç½®ç›‘æ§å‘Šè­¦ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®æ—¥å¿—å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

---

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨æœåŠ¡
systemctl start image-classifier

# åœæ­¢æœåŠ¡
systemctl stop image-classifier

# é‡å¯æœåŠ¡
systemctl restart image-classifier

# æŸ¥çœ‹çŠ¶æ€
systemctl status image-classifier

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u image-classifier -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
journalctl -u image-classifier -n 100
```

### ä»£ç æ›´æ–°
```bash
# åœæ­¢æœåŠ¡
systemctl stop image-classifier

# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
cd /opt/ImageClassifierBackend
git pull

# æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœrequirements.txtæœ‰å˜åŒ–ï¼‰
source venv/bin/activate
pip install -r requirements.txt

# é‡å¯æœåŠ¡
systemctl start image-classifier
```

### æ•°æ®åº“ç»´æŠ¤
```bash
# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
mysql -u classifier -p -e "
USE image_classifier;
SELECT COUNT(*) as total_cached_images, SUM(hit_count) as total_hits 
FROM image_classification_cache;
"

# æŸ¥çœ‹ä»Šæ—¥è¯·æ±‚æ•°
mysql -u classifier -p -e "
USE image_classifier;
SELECT COUNT(*) as today_requests 
FROM request_log 
WHERE created_date = CURDATE();
"
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
journalctl -u image-classifier -n 50 --no-pager

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8000

# æ‰‹åŠ¨æµ‹è¯•
cd /opt/ImageClassifierBackend
source venv/bin/activate
python -c "from app.main import app"
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•MySQLè¿æ¥
mysql -u classifier -p -h localhost image_classifier

# æ£€æŸ¥MySQLæœåŠ¡
systemctl status mysql

# æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log
```

### é—®é¢˜3ï¼šAPIè°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æµ‹è¯•ç«¯å£è¿é€šæ€§
curl http://localhost:8000/api/v1/health

# ä»å¤–ç½‘æµ‹è¯•
curl http://ä½ çš„æœåŠ¡å™¨IP:8000/api/v1/health
```

### é—®é¢˜4ï¼šå¤§æ¨¡å‹APIè°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥APIå¯†é’¥é…ç½®
cd /opt/ImageClassifierBackend
cat .env | grep LLM_API_KEY

# æµ‹è¯•ç½‘ç»œè¿æ¥
curl -I https://dashscope.aliyuncs.com

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/image-classifier/app.log
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆåè¯·æ£€æŸ¥ï¼š

- [ ] Python 3.10å®‰è£…æˆåŠŸ
- [ ] MySQLæœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] æ•°æ®åº“å’Œè¡¨åˆ›å»ºæˆåŠŸ
- [ ] ä»£ç ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] Pythonä¾èµ–å®‰è£…å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] é˜²ç«å¢™ç«¯å£å·²å¼€æ”¾
- [ ] SystemdæœåŠ¡é…ç½®å¹¶å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥æ¥å£è¿”å›æ­£å¸¸
- [ ] å¯ä»¥ä»å¤–ç½‘è®¿é—®APIæ–‡æ¡£
- [ ] æµ‹è¯•åˆ†ç±»æ¥å£å·¥ä½œæ­£å¸¸
- [ ] æ—¥å¿—ç›®å½•åˆ›å»ºæˆåŠŸ
- [ ] Nginxé…ç½®å®Œæˆï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] HTTPSè¯ä¹¦é…ç½®å®Œæˆï¼ˆå¦‚æœä½¿ç”¨ï¼‰

---

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹æ—¥å¿—ï¼š`journalctl -u image-classifier -f`
2. æ£€æŸ¥å¥åº·çŠ¶æ€ï¼š`curl http://localhost:8000/api/v1/health`
3. å‚è€ƒæ•…éšœæ’æŸ¥ç« èŠ‚
4. æŸ¥çœ‹ `docs/DEPLOY.md` äº†è§£æ›´å¤šç»†èŠ‚
5. æŸ¥çœ‹ `æŠ€æœ¯æ–¹æ¡ˆæ¢³ç†.md` äº†è§£æ¶æ„

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **è®¿é—®APIæ–‡æ¡£**ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000/docs`
2. **æµ‹è¯•æ¥å£**ï¼šä½¿ç”¨Postmanæˆ–curl
3. **æŸ¥çœ‹ç»Ÿè®¡**ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000/api/v1/stats/today`
4. **ç®¡ç†åå°**ï¼šè®¿é—®ç®¡ç†åå°è¿›è¡Œè¿ç»´ç®¡ç†

**é‡è¦é“¾æ¥**ï¼š
- APIæ–‡æ¡£ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:8000/docs
- å¥åº·æ£€æŸ¥ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:8000/api/v1/health
- æœåŠ¡å™¨æ—¥å¿—ï¼š`journalctl -u image-classifier -f`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: ImageClassifier Team

