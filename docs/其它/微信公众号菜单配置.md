# 微信公众号菜单配置指南

## 📋 菜单配置

✅ **菜单已通过API创建成功！**

可以通过以下命令重新创建或修改菜单：

```bash
curl -X POST http://admin.xintuxiangce.top:8000/api/v1/auth/wechat/create-menu
```

### 菜单结构

**一级菜单1：芯图相册**
- 类型：网页跳转
- URL：`https://www.xintuxiangce.top`

**一级菜单2：会员服务**
- 类型：带二级菜单
- 二级菜单1：开通会员
  - URL：`https://www.xintuxiangce.top/member.html`
- 二级菜单2：购买额度
  - URL：`https://www.xintuxiangce.top/credits.html`
- 二级菜单3：额度查询
  - URL：`https://www.xintuxiangce.top/credits_info.html`

## 🎯 菜单点击流程

### 1. 芯图相册

用户点击"芯图相册"菜单后：
1. 直接跳转到 `https://www.xintuxiangce.top`
2. 打开芯图相册主页

### 2. 会员服务 - 开通会员

用户点击"会员服务" -> "开通会员"菜单后：
1. 前端检测到 `action=member` 参数
2. 调用 `POST /api/v1/payment/create-order` 创建会员订单
3. 返回 `payment_params`
4. 调起微信支付
5. 用户完成支付

### 3. 会员服务 - 购买额度

用户点击"会员服务" -> "购买额度"菜单后：
1. 前端显示额度选择（10张、20张、50张、100张）
2. 用户选择后调用 `POST /api/v1/payment/create-order` 创建额度订单
3. 返回 `payment_params`
4. 调起微信支付
5. 用户完成支付

### 4. 会员服务 - 额度查询

用户点击"会员服务" -> "额度查询"菜单后：
1. 前端调用 `GET /api/v1/user/credits` 查询额度
2. 显示用户当前额度信息

## ⚙️ 配置步骤

### 使用API接口配置：

由于开启了开发模式，需要在服务端通过API接口配置菜单。

1. **调用菜单创建接口**：
   ```bash
   curl -X POST http://admin.xintuxiangce.top:8000/api/v1/auth/wechat/create-menu
   ```

2. **或者使用测试脚本**：
   ```bash
   python test_create_menu.py
   ```

3. **验证菜单**：
   - 打开微信客户端
   - 进入"芯图相册"公众号
   - 查看底部菜单栏是否显示"芯图相册"和"会员服务"两个一级菜单
   - 点击"会员服务"查看是否显示三个二级菜单

### 注意事项：

1. **必须是HTTPS链接**：微信要求所有链接必须是HTTPS
2. **域名已备案**：`www.xintuxiangce.top` 需要已备案
3. **授权域名**：需要配置JSAPI支付授权目录
4. **菜单限制**：服务号可以有3个一级菜单，每个一级菜单最多5个二级菜单

## 🔧 前端实现

前端需要识别URL参数，根据不同action执行不同操作：

```javascript
// 解析URL参数
const params = new URLSearchParams(window.location.search);
const action = params.get('action');

switch(action) {
    case 'member':
        // 显示会员开通页面，调用支付接口
        break;
    case 'credits':
        // 显示额度购买页面
        break;
    case 'credits_info':
        // 显示当前额度信息
        break;
}
```

## 📝 测试清单

- [ ] 配置菜单后，点击菜单能否正确打开网页
- [ ] 网页中是否能正确调用支付接口
- [ ] 支付完成后是否能正确回调
- [ ] 订单状态是否正确更新
- [ ] 会员/额度是否正确发放

