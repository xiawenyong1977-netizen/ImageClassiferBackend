# 管理后台登录功能说明

## 🔐 登录信息

**登录页面**: http://123.57.68.4:8000/static/login.html

**管理员账号**:
- 用户名: `zywl`
- 密码: `zywl@123`

## 🛡️ 安全设计

### 1. 密码安全
- ✅ 密码使用 **bcrypt** 哈希存储（不可逆）
- ✅ 哈希值存储在服务器 `.env` 文件中
- ✅ 源代码中不包含明文密码

### 2. Token认证
- ✅ 使用 **JWT (JSON Web Token)** 管理会话
- ✅ Token有效期：24小时
- ✅ Token存储在浏览器 localStorage
- ✅ 所有管理API都需要认证

### 3. 受保护的API
以下API需要登录后才能访问：
- `/api/v1/stats/today` - 今日统计
- `/api/v1/stats/cache-efficiency` - 缓存效率
- `/api/v1/stats/category-distribution` - 分类分布
- `/api/v1/location/stats` - 位置数据统计

### 4. 公开API（无需认证）
以下API可以公开访问：
- `/api/v1/health` - 健康检查
- `/api/v1/classify` - 图片分类
- `/api/v1/classify/check-cache` - 缓存检查
- `/api/v1/location/nearest-city` - 查询最近城市
- `/api/v1/location/nearby-cities` - 查询附近城市

## 📱 使用流程

### 首次访问
1. 访问 http://123.57.68.4:8000
2. 自动跳转到登录页面
3. 输入账号密码登录
4. 登录成功后跳转到管理后台

### 已登录状态
- Token有效期内无需重新登录
- 刷新页面保持登录状态
- Token过期后自动跳转登录页

### 退出登录
- 点击右上角"🚪 退出登录"按钮
- 清除本地Token
- 跳转到登录页

## 🔧 管理员密码修改

### 方法1：使用脚本生成新密码哈希
```bash
# 在服务器上执行
cd /opt/ImageClassifierBackend
source venv/bin/activate
python3 << 'EOF'
import bcrypt
new_password = input('输入新密码: ')
hashed = bcrypt.hashpw(new_password.encode('utf-8'), bcrypt.gensalt())
print('\n新的密码哈希值:')
print(hashed.decode('utf-8'))
print('\n请将此哈希值更新到 .env 文件的 ADMIN_PASSWORD_HASH')
EOF
```

### 方法2：直接编辑.env文件
```bash
vi /opt/ImageClassifierBackend/.env

# 修改以下行（替换为新的哈希值）:
ADMIN_PASSWORD_HASH=$2b$12$新的哈希值

# 保存后重启服务
systemctl restart image-classifier
```

## 🔑 JWT密钥更新

**生产环境强烈建议修改JWT密钥！**

```bash
# 生成随机密钥
openssl rand -hex 32

# 更新.env文件
vi /opt/ImageClassifierBackend/.env
# 修改: JWT_SECRET_KEY=生成的随机密钥

# 重启服务
systemctl restart image-classifier
```

## ⚠️ 安全建议

1. **定期更换密码和JWT密钥**
2. **不要在公网暴露管理后台**（建议配置Nginx限制IP访问）
3. **备份.env文件**（包含重要的密钥信息）
4. **监控登录日志**（查看异常登录尝试）
5. **使用HTTPS**（生产环境强烈推荐）

## 📊 当前配置位置

- 配置文件: `/opt/ImageClassifierBackend/.env`
- 前端页面: `/opt/ImageClassifierBackend/web/login.html`
- 后端API: `/opt/ImageClassifierBackend/app/api/auth.py`

---

**最后更新**: 2025-10-11

