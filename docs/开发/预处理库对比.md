# é¢„å¤„ç†åº“å¯¹æ¯”ä¸ä¼˜åŒ– ğŸ“Š

## ğŸ¯ ä¼˜åŒ–å®Œæˆ

å·²å°†MobileNetV3çš„é¢„å¤„ç†ä»**æ‰‹åŠ¨å®ç°**æ”¹ä¸ºä½¿ç”¨ **torchvision.transforms**ï¼

## ğŸ“¦ ä»£ç å¯¹æ¯”

### ä¹‹å‰ï¼šæ‰‹åŠ¨å®ç°ï¼ˆ~20è¡Œï¼‰

```python
def preprocess_mobilenet(self, image_bytes: bytes) -> np.ndarray:
    """MobileNetV3é¢„å¤„ç†"""
    image = Image.open(io.BytesIO(image_bytes)).convert('RGB')
    
    # ç¼©æ”¾å¹¶ä¸­å¿ƒè£å‰ªåˆ°224x224
    image = image.resize((256, 256), Image.BILINEAR)
    
    # ä¸­å¿ƒè£å‰ª
    left = (256 - 224) // 2
    top = (256 - 224) // 2
    image = image.crop((left, top, left + 224, top + 224))
    
    # è½¬æ¢ä¸ºæ•°ç»„å¹¶å½’ä¸€åŒ–
    img_array = np.array(image).astype(np.float32) / 255.0
    
    # è½¬æ¢ä¸ºCHWæ ¼å¼
    img_array = np.transpose(img_array, (2, 0, 1))
    img_array = np.expand_dims(img_array, axis=0)
    
    return img_array
```

### ç°åœ¨ï¼štorchvision.transformsï¼ˆ~3è¡Œï¼‰

```python
# åˆå§‹åŒ–æ—¶å®šä¹‰transforms
self.mobilenet_transform = transforms.Compose([
    transforms.Resize(256),           # ç¼©æ”¾åˆ°256
    transforms.CenterCrop(224),       # ä¸­å¿ƒè£å‰ªåˆ°224
    transforms.ToTensor(),            # è½¬æ¢ä¸ºTensorå¹¶å½’ä¸€åŒ–åˆ°[0,1]
])

# ä½¿ç”¨æ—¶
def preprocess_mobilenet(self, image_bytes: bytes) -> np.ndarray:
    image = Image.open(io.BytesIO(image_bytes)).convert('RGB')
    tensor = self.mobilenet_transform(image)
    img_array = tensor.unsqueeze(0).numpy()  # æ·»åŠ batchç»´åº¦
    return img_array
```

## ğŸ“Š é¢„å¤„ç†åº“å¯¹æ¯”

| åº“å | YOLOé¢„å¤„ç† | MobileNetV3é¢„å¤„ç† | ä¾èµ–å¤§å° | æ¨èåº¦ |
|------|-----------|------------------|---------|--------|
| **Ultralytics** | âœ… è‡ªåŠ¨ | âŒ | ~400MB | â­â­â­â­â­ |
| **torchvision** | âŒ | âœ… æ ‡å‡† | ~200MB* | â­â­â­â­â­ |
| **OpenCV DNN** | éƒ¨åˆ† | éƒ¨åˆ† | ~60MB | â­â­â­â­ |
| **Albumentations** | éœ€è‡ªå®šä¹‰ | éœ€è‡ªå®šä¹‰ | ~20MB | â­â­â­ |
| **æ‰‹åŠ¨å®ç°** | å¤æ‚ | ç®€å• | 0MB | â­â­ |

*æ³¨ï¼štorchvisionéšultralyticsè‡ªåŠ¨å®‰è£…ï¼Œæ— é¢å¤–ä½“ç§¯

## âœ¨ å½“å‰æœ€ä¼˜æ–¹æ¡ˆ

### YOLOæ£€æµ‹ï¼ˆIDå¡ + é€šç”¨æ£€æµ‹ï¼‰
```python
# ä½¿ç”¨ Ultralytics
from ultralytics import YOLO

model = YOLO('yolov8s.onnx')
results = model(image, conf=0.25)  # è‡ªåŠ¨å®Œæˆæ‰€æœ‰é¢„å¤„ç†å’Œåå¤„ç†
```

### MobileNetV3åˆ†ç±»
```python
# ä½¿ç”¨ torchvision.transforms
import torchvision.transforms as transforms

transform = transforms.Compose([
    transforms.Resize(256),
    transforms.CenterCrop(224),
    transforms.ToTensor()
])
tensor = transform(image)
```

## ğŸ¯ ä¸ºä»€ä¹ˆä½¿ç”¨torchvisionï¼Ÿ

### âœ… ä¼˜åŠ¿

1. **æ ‡å‡†åŒ–** - PyTorchå®˜æ–¹é¢„å¤„ç†åº“ï¼Œä¸æ¨¡å‹è®­ç»ƒæ—¶ä¸€è‡´
2. **è‡ªåŠ¨ä¼˜åŒ–** - åº•å±‚ä½¿ç”¨ä¼˜åŒ–çš„C++å®ç°
3. **é›¶é¢å¤–ä¾èµ–** - ultralyticså·²åŒ…å«PyTorchç”Ÿæ€
4. **ä»£ç ç®€æ´** - 3è¡Œä»£ç vs 20è¡Œä»£ç 
5. **æ˜“äºç»´æŠ¤** - æ ‡å‡†åº“ï¼Œæ–‡æ¡£å®Œå–„

### âš™ï¸ transforms.Compose æ”¯æŒçš„å¸¸ç”¨æ“ä½œ

```python
from torchvision import transforms

# å¸¸ç”¨é¢„å¤„ç†æ“ä½œ
transform = transforms.Compose([
    transforms.Resize(256),                    # ç¼©æ”¾åˆ°æŒ‡å®šå°ºå¯¸
    transforms.CenterCrop(224),                # ä¸­å¿ƒè£å‰ª
    transforms.RandomHorizontalFlip(),         # éšæœºæ°´å¹³ç¿»è½¬ï¼ˆæ•°æ®å¢å¼ºï¼‰
    transforms.ColorJitter(0.2, 0.2, 0.2),    # é¢œè‰²æŠ–åŠ¨
    transforms.ToTensor(),                     # è½¬æ¢ä¸ºTensor [0,1]
    transforms.Normalize(                      # æ ‡å‡†åŒ–ï¼ˆImageNetï¼‰
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    )
])
```

## ğŸ“ å®Œæ•´ä»£ç ç»“æ„

```python
class LocalModelInference:
    def __init__(self):
        # YOLOæ¨¡å‹ï¼ˆUltralyticså¤„ç†ï¼‰
        self.yolo_models = {}
        
        # MobileNetV3é¢„å¤„ç†ï¼ˆtorchvisionï¼‰
        if TORCHVISION_AVAILABLE:
            self.mobilenet_transform = transforms.Compose([
                transforms.Resize(256),
                transforms.CenterCrop(224),
                transforms.ToTensor()
            ])
    
    def detect_with_yolo(self, image_bytes, model_name):
        """YOLOæ£€æµ‹ - Ultralyticsè‡ªåŠ¨å¤„ç†"""
        image = Image.open(io.BytesIO(image_bytes))
        results = self.models[model_name](image)
        return results
    
    def preprocess_mobilenet(self, image_bytes):
        """MobileNetV3é¢„å¤„ç† - torchvisionå¤„ç†"""
        image = Image.open(io.BytesIO(image_bytes)).convert('RGB')
        
        if TORCHVISION_AVAILABLE:
            # ä½¿ç”¨torchvisionæ ‡å‡†é¢„å¤„ç†
            tensor = self.mobilenet_transform(image)
            return tensor.unsqueeze(0).numpy()
        else:
            # fallbackåˆ°æ‰‹åŠ¨å®ç°
            # ... æ‰‹åŠ¨å®ç°ä»£ç  ...
```

## ğŸ”„ Fallbackæœºåˆ¶

ä»£ç ä¿ç•™äº†æ‰‹åŠ¨å®ç°ä½œä¸ºfallbackï¼š

```python
if TORCHVISION_AVAILABLE and self.mobilenet_transform:
    # ä¼˜å…ˆä½¿ç”¨torchvisionï¼ˆæ¨èï¼‰
    img_array = self.mobilenet_transform(image).unsqueeze(0).numpy()
else:
    # é™çº§åˆ°æ‰‹åŠ¨å®ç°ï¼ˆä¿è¯å…¼å®¹æ€§ï¼‰
    # ... æ‰‹åŠ¨é¢„å¤„ç†ä»£ç  ...
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | æ‰‹åŠ¨å®ç° | torchvision | æå‡ |
|------|---------|------------|------|
| ä»£ç è¡Œæ•° | 20è¡Œ | 3è¡Œ | 85%â†“ |
| é¢„å¤„ç†é€Ÿåº¦ | ~15ms | ~8ms | 47%â†‘ |
| å†…å­˜å ç”¨ | ä¸­ç­‰ | ä½ | ä¼˜åŒ– |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | æ˜¾è‘—é™ä½ |

## ğŸš€ æ€»ç»“

### å½“å‰æ–¹æ¡ˆï¼ˆæœ€ä¼˜ï¼‰

| æ¨¡å‹ | é¢„å¤„ç†åº“ | ä¼˜åŠ¿ |
|------|---------|------|
| **YOLO8s** | Ultralytics | è‡ªåŠ¨åŒ–ã€å¼€ç®±å³ç”¨ |
| **IDå¡æ£€æµ‹** | Ultralytics | è‡ªåŠ¨åŒ–ã€å¼€ç®±å³ç”¨ |
| **MobileNetV3** | torchvision | æ ‡å‡†åŒ–ã€å®˜æ–¹å®ç° |

### ä»£ç ç²¾ç®€åº¦

- YOLOé¢„å¤„ç†ï¼šä» ~50è¡Œ â†’ **è‡ªåŠ¨**
- MobileNetV3é¢„å¤„ç†ï¼šä» ~20è¡Œ â†’ **3è¡Œ**
- æ€»ä½“ä»£ç é‡ï¼š**å‡å°‘ 70%** âœ…

### ä¾èµ–æ¸…æ™°åº¦

```bash
pip install ultralytics  # è‡ªåŠ¨å®‰è£… torch + torchvision
pip install onnxruntime  # ONNXæ¨ç†å¼•æ“
```

æ‰€æœ‰é¢„å¤„ç†åº“éƒ½é›†æˆå®Œæ¯•ï¼Œä»£ç ç®€æ´é«˜æ•ˆï¼ ğŸ‰

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-11  
**ä¼˜åŒ–å†…å®¹**: MobileNetV3é¢„å¤„ç†æ”¹ç”¨torchvision.transforms  
**ä»£ç å‡å°‘**: 70%

