# 服务器部署步骤

## ✅ 文件已上传到服务器

文件已通过 SCP 上传到服务器：`123.57.68.4`

## 📝 请在服务器上执行以下步骤

### 1. 登录服务器
```bash
ssh root@123.57.68.4
cd /root/ImageClassifierBackend
```

### 2. 创建数据库表
```bash
mysql -u root -p image_classifier < sql/add_wechat_qrcode_bindings.sql
```

### 3. 检查环境变量
```bash
cat .env | grep WECHAT
```

确保包含以下配置：
```
WECHAT_APPID=your_appid
WECHAT_SECRET=your_secret
WECHAT_TOKEN=your_token
```

如果缺少配置，请编辑 `.env` 文件添加。

### 4. 重启服务
```bash
# 方式1：使用部署脚本
bash deploy-to-server.sh

# 方式2：使用systemctl
systemctl restart imageclassifier

# 方式3：使用pm2
pm2 restart imageclassifier
```

### 5. 查看日志确认启动成功
```bash
journalctl -u imageclassifier -n 50 -f
```

或者如果使用 pm2：
```bash
pm2 logs imageclassifier
```

### 6. 测试接口
```bash
# 健康检查
curl https://admin.xintuxiangce.top/api/v1/health

# 测试微信验证接口
curl "https://admin.xintuxiangce.top/api/v1/auth/wechat/verify?signature=test&timestamp=test&nonce=test&echostr=test"
```

### 7. 配置微信公众号

1. 登录微信公众平台：https://mp.weixin.qq.com/
2. 进入「开发」-「基本配置」
3. 配置服务器URL：
   - URL: `https://admin.xintuxiangce.top/api/v1/auth/wechat/verify`
   - Token: [填写您的WECHAT_TOKEN]
   - 消息加解密方式: 明文模式
4. 点击「提交」按钮
5. 如果提示验证成功，说明部署成功！

## 🎉 完成

部署完成后，可以测试生成二维码接口：

```bash
curl -X POST https://admin.xintuxiangce.top/api/v1/auth/wechat/qrcode \
  -H "Content-Type: application/json" \
  -d '{"client_id": "test_001"}'
```
