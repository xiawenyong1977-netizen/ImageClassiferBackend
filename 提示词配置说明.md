# 提示词（Prompt）配置说明

## 📝 提示词的作用

提示词是发送给大模型的指令，决定了：
- ✅ 模型如何理解和分类图片
- ✅ 返回结果的格式
- ✅ 分类的准确度

通过优化提示词，可以提高分类准确率和效果。

---

## 🎯 当前默认提示词

```
请对这张图片进行分类。你必须从以下8个类别中选择一个：

1. social_activities - 社交活动（聚会、合影、多人互动场景）
2. pets - 宠物萌照（猫、狗等宠物照片）
3. single_person - 单人照片（个人照、自拍、肖像）
4. foods - 美食记录（食物、餐饮、烹饪相关）
5. travel_scenery - 旅行风景（旅游景点、自然风光、城市风景）
6. screenshot - 手机截图（手机屏幕截图、应用界面）
7. idcard - 证件照（身份证、护照、驾照等证件）
8. other - 其它（无法归类到上述类别）

请以JSON格式返回结果：
{
    "category": "类别key（必须是上述8个之一）",
    "confidence": 0.95,
    "description": "简短描述图片内容（可选，中文，30字以内）"
}

只返回JSON，不要有其他文字。
```

---

## ⚙️ 在Web界面查看和编辑

### 步骤1：访问配置页面

1. 打开Web界面：http://123.57.68.4:8000/
2. 点击**"⚙️ 配置管理"**标签
3. 滚动到**"分类提示词（Prompt）"**区域

### 步骤2：编辑提示词

- 可以在文本框中直接编辑提示词
- 点击**"恢复默认提示词"**可以重置
- 点击**"保存到本地"**保存到浏览器

### 注意事项

⚠️ **Web界面的编辑仅保存在浏览器本地**，实际生效需要在服务器配置文件中修改。

---

## 🔧 在服务器配置提示词

### 方法1：直接编辑.env文件

```bash
ssh root@123.57.68.4
cd /opt/ImageClassifierBackend
vi .env
```

添加或修改这一行：
```ini
CLASSIFICATION_PROMPT="你自定义的提示词内容"
```

注意转义换行符：
```ini
CLASSIFICATION_PROMPT="第一行\n第二行\n第三行"
```

保存后重启：
```bash
systemctl restart image-classifier
```

### 方法2：使用sed命令（适合简单修改）

```bash
ssh root@123.57.68.4 "cd /opt/ImageClassifierBackend && echo 'CLASSIFICATION_PROMPT=\"你的提示词\"' >> .env && systemctl restart image-classifier"
```

### 方法3：创建prompt.txt文件

**推荐方式**：将提示词保存为独立文件

在服务器上创建：
```bash
ssh root@123.57.68.4
cd /opt/ImageClassifierBackend
cat > prompt.txt << 'EOF'
请对这张图片进行分类。你必须从以下8个类别中选择一个：

1. social_activities - 社交活动（聚会、合影、多人互动场景）
2. pets - 宠物萌照（猫、狗等宠物照片）
3. single_person - 单人照片（个人照、自拍、肖像）
4. foods - 美食记录（食物、餐饮、烹饪相关）
5. travel_scenery - 旅行风景（旅游景点、自然风光、城市风景）
6. screenshot - 手机截图（手机屏幕截图、应用界面）
7. idcard - 证件照（身份证、护照、驾照等证件）
8. other - 其它（无法归类到上述类别）

请以JSON格式返回结果：
{
    "category": "类别key（必须是上述8个之一）",
    "confidence": 0.95,
    "description": "简短描述图片内容（可选，中文，30字以内）"
}

只返回JSON，不要有其他文字。
EOF
```

然后在.env中引用（需要修改代码支持）或直接复制内容。

---

## 💡 提示词优化建议

### 优化方向

1. **更详细的类别说明**
   ```
   social_activities - 社交活动
   包括但不限于：生日派对、聚餐、团建活动、朋友聚会、婚礼现场等
   特征：多人场景、互动、庆祝等元素
   ```

2. **添加示例**
   ```
   例如：
   - 一张5个人在餐厅聚餐的照片 → social_activities
   - 一只可爱的小猫咪 → pets
   ```

3. **强调关键特征**
   ```
   screenshot - 手机截图
   关键特征：包含手机UI元素、状态栏、底部导航栏、应用界面等
   ```

4. **调整置信度标准**
   ```
   如果非常确定某个类别，confidence应该>0.9
   如果有一定把握，confidence在0.7-0.9之间
   如果不太确定，confidence<0.7，可能归为other
   ```

---

## 📊 测试提示词效果

修改提示词后，建议：

1. **上传多张不同类型的图片测试**
2. **观察分类准确率**
3. **检查置信度分布**
4. **查看错误分类案例**
5. **根据结果调整提示词**

在Web界面的"分类测试"页面可以快速测试。

---

## 🔍 查看当前生效的提示词

```bash
ssh root@123.57.68.4
cd /opt/ImageClassifierBackend
cat .env | grep CLASSIFICATION_PROMPT
```

如果没有配置，则使用代码中的默认值（app/config.py中定义）。

---

## ✅ 配置完成检查

- [ ] 提示词已在Web界面查看
- [ ] 根据需要编辑优化
- [ ] 在服务器.env文件中配置（如需修改）
- [ ] 重启服务生效
- [ ] 上传测试图片验证效果

---

## 💻 快速配置示例

如果您想修改提示词，在SSH中执行：

```bash
ssh root@123.57.68.4 << 'EOFSH'
cd /opt/ImageClassifierBackend

# 备份当前配置
cp .env .env.backup

# 添加提示词配置（如果还没有）
if ! grep -q "CLASSIFICATION_PROMPT" .env; then
    echo "" >> .env
    echo "# 提示词配置" >> .env
    echo 'CLASSIFICATION_PROMPT="你的自定义提示词"' >> .env
    systemctl restart image-classifier
    echo "✓ 提示词已添加并重启服务"
else
    echo "提示词配置已存在"
fi
EOFSH
```

---

**现在Web界面已支持提示词查看和编辑！** 刷新页面试试！🎉

