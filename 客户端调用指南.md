# å®¢æˆ·ç«¯è°ƒç”¨æŒ‡å—

## ðŸ“‹ APIåŸºæœ¬ä¿¡æ¯

**æœåŠ¡å™¨åœ°å€**ï¼š`http://123.57.68.4:8000`

**æ ¸å¿ƒæŽ¥å£**ï¼š

### ðŸ¥ åŸºç¡€æœåŠ¡
1. `GET /api/v1/health` - å¥åº·æ£€æŸ¥ï¼ˆåº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼‰

### ðŸ–¼ï¸ å›¾ç‰‡åˆ†ç±»æœåŠ¡
2. `POST /api/v1/classify/check-cache` - æŸ¥è¯¢ç¼“å­˜ï¼ˆæŽ¨èå…ˆè°ƒç”¨ï¼‰
3. `POST /api/v1/classify` - å›¾ç‰‡åˆ†ç±»ï¼ˆè‡ªåŠ¨é€‰æ‹©å¤§æ¨¡åž‹æˆ–å°æ¨¡åž‹ï¼‰

### ðŸ“ åœ°ç†ä½ç½®æœåŠ¡
4. `GET /api/v1/location/nearest-city` - æŸ¥è¯¢æœ€è¿‘çš„åŸŽå¸‚
5. `GET /api/v1/location/nearby-cities` - æŸ¥è¯¢é™„è¿‘åŸŽå¸‚åˆ—è¡¨

---

## ðŸŽ¯ æŽ¨èè°ƒç”¨æµç¨‹

```
åº”ç”¨å¯åŠ¨æ—¶ï¼š
â”œâ”€ è°ƒç”¨ /health æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§
â””â”€ å¦‚æžœæœåŠ¡ä¸å¯ç”¨ â†’ æç¤ºç”¨æˆ·

ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡æ—¶ï¼š
1. è®¡ç®—åŽŸå›¾SHA-256å“ˆå¸Œ
   â†“
2. è°ƒç”¨ /check-cache æŸ¥è¯¢ç¼“å­˜
   â”œâ”€ ç¼“å­˜å‘½ä¸­ â†’ ç›´æŽ¥ä½¿ç”¨ç»“æžœ âœ…ï¼ˆçœå¸¦å®½100%ï¼Œçœç¼©æ”¾æ“ä½œï¼ï¼‰
   â””â”€ ç¼“å­˜æœªå‘½ä¸­ â†’ ç»§ç»­æ­¥éª¤3
   â†“
3. å®¢æˆ·ç«¯ç¼©æ”¾å›¾ç‰‡ï¼ˆ**å¿…é¡»**ï¼š1024pxé•¿è¾¹ï¼Œä¿æŒå®½é«˜æ¯”ï¼Œ80%è´¨é‡ï¼ŒJPEGæ ¼å¼ï¼‰
   â†“
4. è°ƒç”¨ /classify ä¸Šä¼ å›¾ç‰‡ï¼ˆå¸¦ä¸Šæ­¥éª¤1çš„å“ˆå¸Œï¼‰
   â†“
5. èŽ·å–åˆ†ç±»ç»“æžœ
```

---

## ðŸ¥ å¥åº·æ£€æŸ¥æŽ¥å£

### æŽ¥å£è§„èŒƒ

```http
GET /api/v1/health
```

### å“åº”æ ¼å¼

```json
{
  "status": "healthy",
  "timestamp": "2025-10-10T12:00:00Z",
  "database": "connected",
  "model_api": "available"
}
```

### å­—æ®µè¯´æ˜Ž

| å­—æ®µ | ç±»åž‹ | è¯´æ˜Ž |
|------|------|------|
| status | string | æ•´ä½“çŠ¶æ€ï¼š`healthy` / `unhealthy` |
| database | string | æ•°æ®åº“çŠ¶æ€ï¼š`connected` / `disconnected` |
| model_api | string | å¤§æ¨¡åž‹APIçŠ¶æ€ï¼š`available` / `not_configured` |
| timestamp | string | æ£€æŸ¥æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |

---

## ðŸ” æŸ¥è¯¢ç¼“å­˜æŽ¥å£

### æŽ¥å£è§„èŒƒ

```http
POST /api/v1/classify/check-cache
Content-Type: application/json
X-User-ID: {user_id}  // å¯é€‰
```

### è¯·æ±‚å‚æ•°

```json
{
  "image_hash": "abc123..."  // å¿…å¡«ï¼šå›¾ç‰‡SHA-256å“ˆå¸Œ
}
```

### å“åº”æ ¼å¼

**ç¼“å­˜å‘½ä¸­**ï¼š
```json
{
  "cached": true,
  "data": {
    "category": "foods",
    "confidence": 0.92,
    "description": "ä¸€ç›˜ç¾Žå‘³çš„æ„å¤§åˆ©é¢"
  },
  "request_id": "req_xxx"
}
```

**ç¼“å­˜æœªå‘½ä¸­**ï¼š
```json
{
  "cached": false
}
```

---

## ðŸ–¼ï¸ å›¾ç‰‡åˆ†ç±»æŽ¥å£

### æŽ¥å£è§„èŒƒ

```http
POST /api/v1/classify
Content-Type: multipart/form-data
X-User-ID: {user_id}  // å¯é€‰
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»åž‹ | å¿…å¡« | è¯´æ˜Ž |
|------|------|------|------|
| image | File | æ˜¯ | å›¾ç‰‡æ–‡ä»¶ï¼ˆ**å¿…é¡»**ç¼©æ”¾åˆ°1024pxé•¿è¾¹ï¼Œä¿æŒå®½é«˜æ¯”ï¼‰ |
| image_hash | string | æ˜¯ | åŽŸå›¾SHA-256å“ˆå¸Œå€¼ |

### å“åº”æ ¼å¼

**å¤§æ¨¡åž‹æŽ¨ç†**ï¼š
```json
{
  "success": true,
  "data": {
    "category": "foods",
    "confidence": 0.92,
    "description": "ä¸€ç›˜ç¾Žå‘³çš„æ„å¤§åˆ©é¢"
  },
  "from_cache": false,
  "processing_time_ms": 1523,
  "request_id": "req_xxx",
  "timestamp": "2025-10-10T12:00:00Z"
}
```

**å°æ¨¡åž‹æŽ¨ç†**ï¼ˆéœ€å®¢æˆ·ç«¯æ˜ å°„ï¼‰ï¼š
```json
{
  "success": true,
  "data": {
    "category": "",  // ç©ºå­—ç¬¦ä¸²æ ‡è¯†éœ€è¦å®¢æˆ·ç«¯æ˜ å°„
    "confidence": 0.8,
    "description": "å°æ¨¡åž‹æŽ¨ç†ç»“æžœ",
    "local_inference_result": {
      "success": true,
      "message": "æ¨¡åž‹æŽ¨ç†å®Œæˆ",
      "idCardDetections": [
        {
          "classId": 0,
          "className": "id_card_front",
          "confidence": 0.95,
          "bbox": [320.5, 240.2, 400.8, 250.3]  // [x, y, width, height]
        }
      ],
      "generalDetections": [
        {
          "classId": 0,
          "className": "person",
          "confidence": 0.85,
          "bbox": [100.0, 150.0, 200.0, 300.0]
        },
        {
          "classId": 15,
          "className": "cat",
          "confidence": 0.78,
          "bbox": [450.0, 200.0, 150.0, 180.0]
        }
      ],
      "mobileNetV3Detections": {
        "success": true,
        "predictions": [  // Top-5é¢„æµ‹ç»“æžœ
          {
            "index": 285,
            "probability": 0.42,
            "class": "Egyptian cat"
          },
          {
            "index": 340,
            "probability": 0.18,
            "class": "zebra"
          },
          {
            "index": 154,
            "probability": 0.12,
            "class": "Pekinese"
          },
          {
            "index": 89,
            "probability": 0.08,
            "class": "sulphur-crested cockatoo"
          },
          {
            "index": 456,
            "probability": 0.05,
            "class": "bow tie"
          }
        ],
        "validPredictions": [  // ç½®ä¿¡åº¦â‰¥é˜ˆå€¼(0.3)çš„ç»“æžœ
          {
            "index": 285,
            "probability": 0.42,
            "class": "Egyptian cat"
          }
        ],
        "topPrediction": {  // æœ€é«˜æ¦‚çŽ‡çš„é¢„æµ‹
          "index": 285,
          "probability": 0.42,
          "class": "Egyptian cat"
        },
        "confidence": 0.42  // æœ€é«˜ç½®ä¿¡åº¦
      }
    }
  },
  "from_cache": false,
  "processing_time_ms": 342,
  "request_id": "req_xxx",
  "timestamp": "2025-10-10T12:00:00Z"
}
```

**å­—æ®µè¯´æ˜Ž**ï¼š

| å­—æ®µè·¯å¾„ | ç±»åž‹ | è¯´æ˜Ž |
|---------|------|------|
| `local_inference_result.idCardDetections` | array | IDå¡æ£€æµ‹ç»“æžœæ•°ç»„ |
| `local_inference_result.generalDetections` | array | é€šç”¨ç‰©ä½“æ£€æµ‹ç»“æžœæ•°ç»„ï¼ˆYOLO8sï¼Œ80ç±»ï¼‰ |
| `local_inference_result.mobileNetV3Detections` | object | MobileNetV3åˆ†ç±»ç»“æžœå¯¹è±¡ |

**æ£€æµ‹å¯¹è±¡ç»“æž„**ï¼š
```javascript
{
  classId: number,      // ç±»åˆ«ID
  className: string,    // ç±»åˆ«åç§°ï¼ˆè‹±æ–‡ï¼‰
  confidence: number,   // ç½®ä¿¡åº¦ (0-1)
  bbox: [x, y, w, h]   // è¾¹ç•Œæ¡† [ä¸­å¿ƒx, ä¸­å¿ƒy, å®½åº¦, é«˜åº¦]
}
```

**MobileNetV3ç»“æžœç»“æž„**ï¼š
```javascript
{
  success: boolean,          // æŽ¨ç†æ˜¯å¦æˆåŠŸ
  predictions: [             // Top-5é¢„æµ‹ç»“æžœï¼ˆæŒ‰æ¦‚çŽ‡é™åºï¼‰
    {
      index: number,         // ImageNetç±»åˆ«ç´¢å¼• (0-999)
      probability: number,   // æ¦‚çŽ‡ (0-1)
      class: string          // ç±»åˆ«åç§°ï¼ˆå¦‚ "Egyptian cat"ï¼‰
    }
    // ... å…±5ä¸ªé¢„æµ‹ç»“æžœ
  ],
  validPredictions: [...],   // ç½®ä¿¡åº¦â‰¥é˜ˆå€¼(0.3)çš„é¢„æµ‹ç»“æžœ
  topPrediction: {...},      // æœ€é«˜æ¦‚çŽ‡çš„é¢„æµ‹ï¼ˆpredictions[0]ï¼‰
  confidence: number         // æœ€é«˜ç½®ä¿¡åº¦
}
```

### åˆ†ç±»ç±»åˆ«

| ç±»åˆ«Key | ä¸­æ–‡åç§° | è¯´æ˜Ž |
|---------|----------|------|
| social_activities | ç¤¾äº¤æ´»åŠ¨ | å¤šäººåˆç…§ã€èšä¼šç­‰ |
| pets | å® ç‰©èŒç…§ | çŒ«ã€ç‹—ã€é¸Ÿç­‰å® ç‰© |
| single_person | å•äººç…§ç‰‡ | å•äººè‚–åƒã€è‡ªæ‹ç­‰ |
| foods | ç¾Žé£Ÿè®°å½• | é£Ÿç‰©ã€é¤é¥®ç…§ç‰‡ |
| travel_scenery | æ—…è¡Œé£Žæ™¯ | é£Žæ™¯ã€å»ºç­‘ã€æ—…æ¸¸ç…§ç‰‡ |
| screenshot | æ‰‹æœºæˆªå›¾ | æ‰‹æœºå±å¹•æˆªå›¾ |
| idcard | è¯ä»¶ç…§ | èº«ä»½è¯ã€è¯ä»¶ç±»ç…§ç‰‡ |
| other | å…¶å®ƒ | æ— æ³•æ˜Žç¡®åˆ†ç±»çš„ç…§ç‰‡ |

---

## ðŸ“ åœ°ç†ä½ç½®æŽ¥å£

### 1. æŸ¥è¯¢æœ€è¿‘çš„åŸŽå¸‚

#### æŽ¥å£è§„èŒƒ

```http
GET /api/v1/location/nearest-city?latitude={lat}&longitude={lng}&user_id={user_id}
```

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»åž‹ | å¿…å¡« | èŒƒå›´ | è¯´æ˜Ž |
|------|------|------|------|------|
| latitude | float | æ˜¯ | -90 ~ 90 | çº¬åº¦ |
| longitude | float | æ˜¯ | -180 ~ 180 | ç»åº¦ |
| user_id | string | å¦ | - | ç”¨æˆ·IDï¼ˆç”¨äºŽç»Ÿè®¡ï¼‰ |

#### å“åº”æ ¼å¼

```json
{
  "id": 1780,
  "geoname_id": 1816670,
  "name": "Beijing",
  "name_zh": "åŒ—äº¬",
  "latitude": 39.9075,
  "longitude": 116.39723,
  "country_code": "CN",
  "population": 18960744,
  "distance_km": 0.94
}
```

### 2. æŸ¥è¯¢é™„è¿‘åŸŽå¸‚åˆ—è¡¨

#### æŽ¥å£è§„èŒƒ

```http
GET /api/v1/location/nearby-cities?latitude={lat}&longitude={lng}&limit={limit}&max_distance_km={distance}&user_id={user_id}
```

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»åž‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜Ž |
|------|------|------|--------|------|
| latitude | float | æ˜¯ | - | çº¬åº¦ |
| longitude | float | æ˜¯ | - | ç»åº¦ |
| limit | int | å¦ | 10 | è¿”å›žç»“æžœæ•°é‡ï¼ˆ1-100ï¼‰ |
| max_distance_km | float | å¦ | ä¸é™åˆ¶ | æœ€å¤§è·ç¦»ï¼ˆå…¬é‡Œï¼‰ |
| user_id | string | å¦ | - | ç”¨æˆ·ID |

#### å“åº”æ ¼å¼

```json
[
  {
    "id": 1780,
    "name": "Beijing",
    "name_zh": "åŒ—äº¬",
    "latitude": 39.9075,
    "longitude": 116.39723,
    "distance_km": 0.94
  },
  ...
]
```

---

## ðŸ’» JavaScript å®Œæ•´ç¤ºä¾‹

```javascript
const API_BASE_URL = 'http://123.57.68.4:8000';

// åˆ†ç±»æ˜ å°„è¡¨
const categoryMap = {
  "social_activities": "ç¤¾äº¤æ´»åŠ¨",
  "pets": "å® ç‰©èŒç…§",
  "single_person": "å•äººç…§ç‰‡",
  "foods": "ç¾Žé£Ÿè®°å½•",
  "travel_scenery": "æ—…è¡Œé£Žæ™¯",
  "screenshot": "æ‰‹æœºæˆªå›¾",
  "idcard": "è¯ä»¶ç…§",
  "other": "å…¶å®ƒ"
};

/**
 * 1. å¥åº·æ£€æŸ¥
 */
async function checkHealth() {
  const response = await fetch(`${API_BASE_URL}/api/v1/health`);
  return await response.json();
}

/**
 * 2. è®¡ç®—SHA-256å“ˆå¸Œ
 */
async function calculateSHA256(imageFile) {
  const arrayBuffer = await imageFile.arrayBuffer();
  const hashBuffer = await crypto.subtle.digest('SHA-256', arrayBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

/**
 * 3. ç¼©æ”¾å›¾ç‰‡ï¼ˆå¿…é¡»ï¼š1024pxé•¿è¾¹ï¼Œä¿æŒå®½é«˜æ¯”ï¼‰
 */
async function resizeImage(imageFile) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    img.onload = () => {
      const maxSize = 1024;
      let width = img.width;
      let height = img.height;
      
      if (width > maxSize || height > maxSize) {
        if (width > height) {
          height = (height / width) * maxSize;
          width = maxSize;
        } else {
          width = (width / height) * maxSize;
          height = maxSize;
        }
      }
      
      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(img, 0, 0, width, height);
      
      canvas.toBlob((blob) => {
        resolve(new File([blob], imageFile.name, { type: 'image/jpeg' }));
      }, 'image/jpeg', 0.8);
    };
    
    img.onerror = reject;
    img.src = URL.createObjectURL(imageFile);
  });
}

/**
 * 4. æŸ¥è¯¢ç¼“å­˜
 */
async function checkCache(imageHash, userId = null) {
  const headers = { 'Content-Type': 'application/json' };
  if (userId) headers['X-User-ID'] = userId;
  
  const response = await fetch(`${API_BASE_URL}/api/v1/classify/check-cache`, {
    method: 'POST',
    headers: headers,
    body: JSON.stringify({ image_hash: imageHash })
  });
  
  return await response.json();
}

/**
 * 5. ä¸Šä¼ åˆ†ç±»
 */
async function uploadAndClassify(imageFile, imageHash, userId = null) {
  const formData = new FormData();
  formData.append('image', imageFile);
  formData.append('image_hash', imageHash);
  
  const headers = {};
  if (userId) headers['X-User-ID'] = userId;
  
  const response = await fetch(`${API_BASE_URL}/api/v1/classify`, {
    method: 'POST',
    headers: headers,
    body: formData
  });
  
  return await response.json();
}

/**
 * 6. å®¢æˆ·ç«¯åˆ†ç±»æ˜ å°„ï¼ˆå°æ¨¡åž‹æŽ¨ç†ç»“æžœï¼‰
 */
function mapDetectionsToCategory(localResult) {
  const { idCardDetections, generalDetections } = localResult;
  
  // 1. æ£€æµ‹åˆ°èº«ä»½è¯
  if (idCardDetections && idCardDetections.length > 0) {
    return 'idcard';
  }
  
  // 2. ç»Ÿè®¡äººæ•°
  const personCount = generalDetections.filter(d => d.className === 'person').length;
  if (personCount === 1) return 'single_person';
  if (personCount > 1) return 'social_activities';
  
  // 3. æ£€æµ‹å® ç‰©
  const petClasses = ['cat', 'dog', 'bird'];
  if (generalDetections.some(d => petClasses.includes(d.className))) {
    return 'pets';
  }
  
  // 4. æ£€æµ‹é£Ÿç‰©
  const foodClasses = ['pizza', 'donut', 'cake', 'sandwich', 'banana', 'apple', 'orange'];
  if (generalDetections.some(d => foodClasses.includes(d.className))) {
    return 'foods';
  }
  
  // 5. æ£€æµ‹ç‰©ä½“å°‘ â†’ é£Žæ™¯
  if (generalDetections.length <= 3) {
    return 'travel_scenery';
  }
  
  // 6. é»˜è®¤åˆ†ç±»
  return 'other';
}

/**
 * 7. å®Œæ•´åˆ†ç±»æµç¨‹
 */
async function classifyImage(imageFile, userId = null) {
  try {
    // æ­¥éª¤1: è®¡ç®—åŽŸå›¾å“ˆå¸Œ
    const imageHash = await calculateSHA256(imageFile);
    console.log(`ðŸ”‘ å“ˆå¸Œ: ${imageHash.substring(0, 16)}...`);
    
    // æ­¥éª¤2: æŸ¥è¯¢ç¼“å­˜
    console.log('ðŸ” æŸ¥è¯¢ç¼“å­˜...');
    const cacheResult = await checkCache(imageHash, userId);
    
    if (cacheResult.cached) {
      console.log('âœ… ç¼“å­˜å‘½ä¸­ï¼æ— éœ€ä¸Šä¼ ');
      return {
        ...cacheResult.data,
        category_name: categoryMap[cacheResult.data.category],
        from_cache: true,
        request_id: cacheResult.request_id
      };
    }
    
    // æ­¥éª¤3: ç¼©æ”¾å›¾ç‰‡ï¼ˆå¿…é¡»ï¼šå¤§æ¨¡åž‹æŽ¥å£é™åˆ¶ï¼‰
    console.log('ðŸ“ ç¼©æ”¾å›¾ç‰‡åˆ°1024px...');
    const resized = await resizeImage(imageFile);
    
    // æ­¥éª¤4: ä¸Šä¼ åˆ†ç±»
    console.log('â¬†ï¸  ä¸Šä¼ å›¾ç‰‡åˆ†ç±»...');
    const result = await uploadAndClassify(resized, imageHash, userId);
    
    if (!result.success) {
      throw new Error(result.error || 'åˆ†ç±»å¤±è´¥');
    }
    
    const data = result.data;
    
    // åˆ¤æ–­æŽ¨ç†æ–¹å¼
    if (!data.category && data.local_inference_result) {
      // å°æ¨¡åž‹æŽ¨ç† - éœ€è¦å®¢æˆ·ç«¯æ˜ å°„
      console.log('ðŸ¤– å°æ¨¡åž‹æŽ¨ç†ï¼Œè¿›è¡Œå®¢æˆ·ç«¯æ˜ å°„...');
      const categoryId = mapDetectionsToCategory(data.local_inference_result);
      
      return {
        category: categoryId,
        category_name: categoryMap[categoryId],
        confidence: 0.8,
        inference_method: 'small_model',
        from_cache: false,
        request_id: result.request_id,
        processing_time_ms: result.processing_time_ms
      };
    } else {
      // å¤§æ¨¡åž‹æŽ¨ç† - ç›´æŽ¥ä½¿ç”¨
      console.log('ðŸŒŸ å¤§æ¨¡åž‹æŽ¨ç†æˆåŠŸ');
      return {
        category: data.category,
        category_name: categoryMap[data.category],
        confidence: data.confidence,
        description: data.description,
        inference_method: 'llm',
        from_cache: false,
        request_id: result.request_id,
        processing_time_ms: result.processing_time_ms
      };
    }
    
  } catch (error) {
    console.error('âŒ åˆ†ç±»å¤±è´¥:', error);
    throw error;
  }
}

/**
 * 8. åœ°ç†ä½ç½®æŸ¥è¯¢
 */
async function getNearestCity(latitude, longitude, userId = null) {
  let url = `${API_BASE_URL}/api/v1/location/nearest-city?latitude=${latitude}&longitude=${longitude}`;
  if (userId) url += `&user_id=${userId}`;
  
  const response = await fetch(url);
  const city = await response.json();
  
  // ä¼˜å…ˆä½¿ç”¨ä¸­æ–‡åç§°
  return {
    ...city,
    displayName: city.name_zh || city.name
  };
}

/**
 * ä½¿ç”¨ç¤ºä¾‹
 */
async function example() {
  // 1. æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
  const health = await checkHealth();
  console.log('æœåŠ¡çŠ¶æ€:', health.status);
  
  // 2. åˆ†ç±»å›¾ç‰‡
  const fileInput = document.getElementById('image-input');
  const imageFile = fileInput.files[0];
  
  const result = await classifyImage(imageFile, 'user-123');
  console.log('åˆ†ç±»ç»“æžœ:', result.category_name);
  console.log('ç½®ä¿¡åº¦:', (result.confidence * 100).toFixed(1) + '%');
  console.log('è€—æ—¶:', result.processing_time_ms + 'ms');
  
  // 3. æŸ¥è¯¢åœ°ç†ä½ç½®ï¼ˆå¦‚æžœç…§ç‰‡æœ‰GPSä¿¡æ¯ï¼‰
  const city = await getNearestCity(39.9042, 116.4074);
  console.log('æ‹æ‘„åœ°ç‚¹:', city.displayName);
}
```

---

## ðŸ¤– æ··åˆæŽ¨ç†æœºåˆ¶è¯´æ˜Ž

æœåŠ¡å™¨æ”¯æŒä¸¤ç§æŽ¨ç†æ–¹å¼ï¼Œä¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©ï¼š

### æŽ¨ç†æ–¹å¼å¯¹æ¯”

| ç‰¹æ€§ | å¤§æ¨¡åž‹ï¼ˆLLMï¼‰ | å°æ¨¡åž‹ï¼ˆONNXï¼‰ |
|------|--------------|---------------|
| **å‡†ç¡®æ€§** | âœ… é«˜ | âš ï¸ ä¸­ç­‰ |
| **é€Ÿåº¦** | âŒ æ…¢ï¼ˆ3-10ç§’ï¼‰ | âœ… å¿«ï¼ˆ< 500msï¼‰ |
| **è´¹ç”¨** | âŒ éœ€è¦APIè´¹ç”¨ | âœ… æ— è´¹ç”¨ |
| **å®¢æˆ·ç«¯å¤„ç†** | âœ… ç›´æŽ¥ä½¿ç”¨ | âš ï¸ éœ€è¦æ˜ å°„ |

### åˆ¤æ–­æ ‡è¯†

å®¢æˆ·ç«¯é€šè¿‡å“åº”ä¸­çš„ `category` å­—æ®µåˆ¤æ–­ï¼š

```javascript
if (!data.category && data.local_inference_result) {
  // å°æ¨¡åž‹æŽ¨ç† - éœ€è¦å®¢æˆ·ç«¯æ˜ å°„
  const categoryId = mapDetectionsToCategory(data.local_inference_result);
} else {
  // å¤§æ¨¡åž‹æŽ¨ç† - ç›´æŽ¥ä½¿ç”¨
  const categoryId = data.category;
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å›¾ç‰‡å¤„ç†è¦æ±‚ï¼ˆå¿…é¡»éµå®ˆï¼‰
- **å¿…é¡»ç¼©æ”¾**ï¼šé•¿è¾¹ç¼©æ”¾åˆ°1024pxï¼Œä¿æŒå®½é«˜æ¯”ä¸å˜
- **å¿…é¡»è½¬æ¢æ ¼å¼**ï¼šJPEGæ ¼å¼ï¼Œè´¨é‡80%
- **åŽŸå› **ï¼šå¤§æ¨¡åž‹APIæŽ¥å£å¯¹å›¾ç‰‡å°ºå¯¸æœ‰ä¸¥æ ¼é™åˆ¶
- **æœ€å¤§å¤§å°**ï¼š10MBï¼ˆåŽŸå›¾ï¼‰
- **æ”¯æŒæ ¼å¼**ï¼šJPG, PNG, WebP, GIFï¼ˆä¸Šä¼ å‰ä¼šç»Ÿä¸€è½¬ä¸ºJPEGï¼‰

### 2. å“ˆå¸Œè®¡ç®—
- **å¿…é¡»ä¼ é€’**ï¼š`image_hash` æ˜¯å¿…å¡«å‚æ•°
- **è®¡ç®—æ—¶æœº**ï¼šåœ¨ç¼©æ”¾å‰è®¡ç®—åŽŸå›¾å“ˆå¸Œ
- **ç”¨é€”**ï¼šç”¨äºŽç¼“å­˜åŽ»é‡å’ŒæŸ¥è¯¢

### 3. é”™è¯¯å¤„ç†
- **è¶…æ—¶è®¾ç½®**ï¼šå»ºè®®30ç§’
- **é‡è¯•æœºåˆ¶**ï¼šç½‘ç»œé”™è¯¯å¯ä»¥é‡è¯•
- **å¼‚å¸¸æ•èŽ·**ï¼šå§‹ç»ˆæ·»åŠ try-catch

### 4. æ€§èƒ½ä¼˜åŒ–
- **å…ˆæŸ¥ç¼“å­˜**ï¼šå¯ä»¥çœç•¥ç¼©æ”¾æ“ä½œï¼ˆç¼“å­˜å‘½ä¸­çŽ‡çº¦50%æ—¶æ€§èƒ½æå‡37.5%ï¼‰
- **åŽ‹ç¼©ä¼ è¾“**ï¼šç¼©æ”¾åŽçš„å›¾ç‰‡é€šå¸¸åªæœ‰200KBå·¦å³
- **å¹¶å‘æŽ§åˆ¶**ï¼šé¿å…åŒæ—¶ä¸Šä¼ è¿‡å¤šå›¾ç‰‡

---

## ðŸ“ž èŽ·å–å¸®åŠ©

- **APIåœ¨çº¿æ–‡æ¡£**ï¼šhttp://123.57.68.4:8000/docs
- **ç®¡ç†åŽå°**ï¼šhttp://123.57.68.4:8000/
- **æŠ€æœ¯æ”¯æŒ**ï¼šæŸ¥çœ‹é¡¹ç›®ä¸­çš„å…¶ä»–æŠ€æœ¯æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**æœ€åŽæ›´æ–°**ï¼š2025-10-11
