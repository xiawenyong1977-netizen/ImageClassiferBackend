# å¾®ä¿¡æ‰«ç å…³æ³¨åŠŸèƒ½éƒ¨ç½²å®Œæˆæ€»ç»“

## âœ… éƒ¨ç½²çŠ¶æ€ï¼šæˆåŠŸ

### ğŸ“… éƒ¨ç½²æ—¶é—´
2025-10-27 21:47

### ğŸ–¥ï¸ æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨IP**: 123.57.68.4
- **é¡¹ç›®è·¯å¾„**: /opt/ImageClassifierBackend
- **æœåŠ¡ç«¯å£**: 8000

### ğŸ“¦ å·²éƒ¨ç½²æ–‡ä»¶
1. âœ… `app/main.py` - æ·»åŠ äº†å¾®ä¿¡GETå’ŒPOSTè·¯ç”±
2. âœ… `app/api/auth.py` - å¾®ä¿¡è®¤è¯ç›¸å…³æ¥å£
3. âœ… `app/api/user.py` - ç”¨æˆ·é¢åº¦æŸ¥è¯¢æ¥å£
4. âœ… `app/api/image_edit.py` - å›¾ç‰‡ç¼–è¾‘API
5. âœ… `app/services/image_editor.py` - å›¾ç‰‡ç¼–è¾‘æœåŠ¡ï¼ˆæ”¯æŒé¢åº¦ç®¡ç†ï¼‰
6. âœ… `app/config.py` - é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«å¾®ä¿¡é…ç½®ï¼‰
7. âœ… `sql/add_wechat_qrcode_bindings.sql` - æ•°æ®åº“è¡¨

### ğŸ—„ï¸ æ•°æ®åº“
- âœ… å·²åˆ›å»º `wechat_qrcode_bindings` è¡¨
- âœ… è¡¨ç»“æ„ï¼šclient_id, scene_id, openid, status, created_at, completed_at

### ğŸ”§ æœåŠ¡çŠ¶æ€
```
æœåŠ¡è¿›ç¨‹ID: 294847
æœåŠ¡åœ°å€: http://0.0.0.0:8000
çŠ¶æ€: è¿è¡Œä¸­ âœ“
æ•°æ®åº“: å·²è¿æ¥ âœ“
```

### ğŸ“‹ APIç«¯ç‚¹
1. âœ… `GET /api/v1/auth/wechat/verify` - å¾®ä¿¡æœåŠ¡å™¨éªŒè¯
2. âœ… `POST /api/v1/auth/wechat/verify` - å¾®ä¿¡æ¶ˆæ¯æ¨é€
3. âœ… `POST /api/v1/auth/wechat/qrcode` - ç”ŸæˆäºŒç»´ç 
4. âœ… `GET /api/v1/auth/wechat/check-follow` - æ£€æŸ¥å…³æ³¨çŠ¶æ€
5. âœ… `GET /api/v1/user/credits` - æŸ¥è¯¢ç”¨æˆ·é¢åº¦

### ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

#### 1. é…ç½®å¾®ä¿¡å…¬ä¼—å·
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°ï¼šhttps://mp.weixin.qq.com/
2. è¿›å…¥ã€Œå¼€å‘ã€-ã€ŒåŸºæœ¬é…ç½®ã€
3. é…ç½®æœåŠ¡å™¨URLï¼š
   - URL: `https://admin.xintuxiangce.top/api/v1/auth/wechat/verify`
   - Token: [ä¸æœåŠ¡å™¨ä¸Šçš„ WECHAT_TOKEN ä¸€è‡´]
   - æ¶ˆæ¯åŠ è§£å¯†æ–¹å¼: æ˜æ–‡æ¨¡å¼
4. ç‚¹å‡»ã€Œæäº¤ã€æŒ‰é’®éªŒè¯

#### 2. æµ‹è¯•åŠŸèƒ½
```bash
# ç”ŸæˆäºŒç»´ç æµ‹è¯•
curl -X POST https://admin.xintuxiangce.top/api/v1/auth/wechat/qrcode \
  -H "Content-Type: application/json" \
  -d '{"client_id": "test_001"}'

# æ£€æŸ¥å…³æ³¨çŠ¶æ€
curl "https://admin.xintuxiangce.top/api/v1/auth/wechat/check-follow?client_id=test_001"
```

### âš™ï¸ é…ç½®è¦æ±‚
ç¡®ä¿æœåŠ¡å™¨ä¸Šçš„å¾®ä¿¡é…ç½®æ­£ç¡®ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
WECHAT_APPID=your_appid
WECHAT_SECRET=your_secret  
WECHAT_TOKEN=your_token
```

### ğŸ” ç›‘æ§å’Œæ—¥å¿—
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
ssh root@123.57.68.4 "tail -f /tmp/app.log"

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
ssh root@123.57.68.4 "ps aux | grep uvicorn"

# æ£€æŸ¥ç«¯å£
ssh root@123.57.68.4 "lsof -i:8000"
```

### ğŸ¯ åŠŸèƒ½è¯´æ˜
1. **ç”¨æˆ·æ‰«ç å…³æ³¨** â†’ åç«¯æ¥æ”¶äº‹ä»¶ â†’ åˆ›å»ºç”¨æˆ·ï¼ˆ100å¼ é¢åº¦ï¼‰â†’ å»ºç«‹ client_id å’Œ openid æ˜ å°„
2. **å®¢æˆ·ç«¯æŸ¥è¯¢** â†’ é€šè¿‡ client_id æŸ¥è¯¢ openid â†’ è·å–ç”¨æˆ·é¢åº¦
3. **å›¾ç‰‡ç¼–è¾‘** â†’ ä¼ é€’ openid Header â†’ æ‰£é™¤é¢åº¦ â†’ è¿”å›ç»“æœ

### ğŸ“Œ æ³¨æ„äº‹é¡¹
1. é¢åº¦åˆå§‹åŒ–ï¼šæ–°ç”¨æˆ·å…³æ³¨åè·å¾— 100 å¼ é¢åº¦
2. é¢åº¦ç®¡ç†ï¼šæŒ‰ openid ç»Ÿä¸€ç®¡ç†ï¼Œå¤šä¸ª client_id å…±äº«åŒä¸€é¢åº¦
3. scene_id å”¯ä¸€æ€§ï¼šä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§
4. äºŒç»´ç æœ‰æ•ˆæœŸï¼š30å¤©

### âœ… éƒ¨ç½²å®Œæˆ
æ‰€æœ‰æ–‡ä»¶å·²ä¸Šä¼ ï¼Œæ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ŒæœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œæ­£å¸¸ï¼

ğŸ‰ å¯ä»¥å¼€å§‹æµ‹è¯•å¾®ä¿¡æ‰«ç å…³æ³¨åŠŸèƒ½äº†ï¼
