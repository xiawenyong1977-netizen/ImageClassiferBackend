# å·¥å…·è„šæœ¬ç›®å½•

æœ¬ç›®å½•åŒ…å«é¡¹ç›®å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å„ç§å·¥å…·è„šæœ¬ï¼Œå·²æŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ã€‚

## ğŸ“ ç›®å½•ç»“æ„

å·¥å…·è„šæœ¬å·²æŒ‰ä»¥ä¸‹5ä¸ªç±»åˆ«è¿›è¡Œåˆ†ç±»ï¼š

```
tools/
â”œâ”€â”€ éƒ¨ç½²/          # éƒ¨ç½²ç›¸å…³è„šæœ¬
â”œâ”€â”€ æ•°æ®åº“/        # æ•°æ®åº“ç®¡ç†è„šæœ¬
â”œâ”€â”€ åŒæ­¥/          # æ•°æ®åŒæ­¥è„šæœ¬
â”œâ”€â”€ æµ‹è¯•/          # æµ‹è¯•ç›¸å…³è„šæœ¬
â””â”€â”€ å·¥å…·/          # å…¶ä»–å·¥å…·è„šæœ¬
```

---

## ğŸš€ [éƒ¨ç½²](./éƒ¨ç½²/) - éƒ¨ç½²ç›¸å…³è„šæœ¬

åŒ…å«æœåŠ¡å™¨éƒ¨ç½²ã€æœåŠ¡å¯åŠ¨ç­‰éƒ¨ç½²ç›¸å…³çš„è„šæœ¬ã€‚

### è„šæœ¬åˆ—è¡¨

- **`deploy-to-server.sh`** - è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆå®Œæ•´éƒ¨ç½²æµç¨‹ï¼‰
- **`deploy_wechat.sh`** - å¾®ä¿¡ç›¸å…³éƒ¨ç½²è„šæœ¬
- **`start.sh`** - æœåŠ¡å¯åŠ¨è„šæœ¬
- **`deploy.ps1`** - PowerShelléƒ¨ç½²è„šæœ¬

### ä½¿ç”¨æ–¹æ³•

```bash
# å®Œæ•´éƒ¨ç½²
bash tools/éƒ¨ç½²/deploy-to-server.sh

# å¯åŠ¨æœåŠ¡
bash tools/éƒ¨ç½²/start.sh

# å¾®ä¿¡éƒ¨ç½²
bash tools/éƒ¨ç½²/deploy_wechat.sh
```

---

## ğŸ—„ï¸ [æ•°æ®åº“](./æ•°æ®åº“/) - æ•°æ®åº“ç®¡ç†è„šæœ¬å’ŒSQLè„šæœ¬

åŒ…å«æ•°æ®åº“å¯¼å‡ºã€å¯¼å…¥ã€ä¸»ä»é…ç½®ç­‰æ•°æ®åº“ç®¡ç†è„šæœ¬ï¼Œä»¥åŠæ•°æ®åº“åˆå§‹åŒ–ã€è¿ç§»ç­‰SQLè„šæœ¬ã€‚

### Shellè„šæœ¬åˆ—è¡¨

- **`export-import-database.sh`** - æ•°æ®åº“å¯¼å‡ºå’Œå¯¼å…¥è„šæœ¬ï¼ˆWebæœåŠ¡å™¨â†’AppæœåŠ¡å™¨ï¼‰
- **`setup-mysql-master.sh`** - MySQLä¸»æœåŠ¡å™¨é…ç½®è„šæœ¬
- **`setup-mysql-slave.sh`** - MySQLä»æœåŠ¡å™¨é…ç½®è„šæœ¬
- **`update-image-edit-urls.sh`** - æ›´æ–°image_edit_cacheè¡¨ä¸­çš„result_urlå­—æ®µ

### SQLè„šæœ¬åˆ—è¡¨

#### åˆå§‹åŒ–è„šæœ¬
- **`init.sql`** - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼ˆåˆ›å»ºæ‰€æœ‰è¡¨ç»“æ„ï¼‰

#### åŠŸèƒ½æ‰©å±•è„šæœ¬ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰
- **`add_inference_method.sql`** - æ·»åŠ æ¨ç†æ–¹æ³•å­—æ®µ
- **`add_batch_cache_stats.sql`** - æ·»åŠ æ‰¹é‡ç¼“å­˜ç»Ÿè®¡è¡¨
- **`add_batch_classify_stats.sql`** - æ·»åŠ æ‰¹é‡åˆ†ç±»ç»Ÿè®¡è¡¨
- **`add_image_edit_tasks.sql`** - æ·»åŠ å›¾åƒç¼–è¾‘ä»»åŠ¡è¡¨
- **`add_image_hash_to_edit_tasks.sql`** - ä¸ºç¼–è¾‘ä»»åŠ¡è¡¨æ·»åŠ å›¾ç‰‡å“ˆå¸Œå­—æ®µ
- **`add_image_edit_cache.sql`** - æ·»åŠ å›¾åƒç¼–è¾‘ç¼“å­˜è¡¨
- **`add_image_edit_credit_stats.sql`** - æ·»åŠ å›¾åƒç¼–è¾‘é¢åº¦ç»Ÿè®¡è¡¨
- **`add_openid_to_image_edit_tasks.sql`** - ä¸ºç¼–è¾‘ä»»åŠ¡è¡¨æ·»åŠ openidå­—æ®µ
- **`add_payment_tables.sql`** - æ·»åŠ æ”¯ä»˜ç›¸å…³è¡¨
- **`add_wechat_users.sql`** - æ·»åŠ å¾®ä¿¡ç”¨æˆ·è¡¨
- **`add_wechat_qrcode_bindings.sql`** - æ·»åŠ å¾®ä¿¡äºŒç»´ç ç»‘å®šè¡¨

#### æ•°æ®ä¿®æ”¹è„šæœ¬
- **`modify_scene_id_to_string.sql`** - å°†scene_idå­—æ®µä¿®æ”¹ä¸ºå­—ç¬¦ä¸²ç±»å‹
- **`revert_scene_id_to_int.sql`** - å°†scene_idå­—æ®µæ¢å¤ä¸ºæ•´æ•°ç±»å‹
- **`remove_image_hash_from_tasks.sql`** - ä»ä»»åŠ¡è¡¨ä¸­ç§»é™¤å›¾ç‰‡å“ˆå¸Œå­—æ®µ

#### å·¥å…·è„šæœ¬
- **`check_user_status.sql`** - æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
- **`reset_member_and_credits.sql`** - é‡ç½®ä¼šå‘˜å’Œé¢åº¦

### ä½¿ç”¨æ–¹æ³•

#### Shellè„šæœ¬
```bash
# å¯¼å‡ºå’Œå¯¼å…¥æ•°æ®åº“
bash tools/æ•°æ®åº“/export-import-database.sh

# é…ç½®MySQLä¸»æœåŠ¡å™¨
bash tools/æ•°æ®åº“/setup-mysql-master.sh

# é…ç½®MySQLä»æœåŠ¡å™¨
bash tools/æ•°æ®åº“/setup-mysql-slave.sh

# æ›´æ–°URLå­—æ®µ
bash tools/æ•°æ®åº“/update-image-edit-urls.sh
```

#### SQLè„šæœ¬
```bash
# åˆå§‹åŒ–æ•°æ®åº“
mysql -u root -p image_classifier < tools/æ•°æ®åº“/init.sql

# æ‰§è¡Œè¿ç§»è„šæœ¬ï¼ˆæŒ‰é¡ºåºï¼‰
mysql -u root -p image_classifier < tools/æ•°æ®åº“/add_inference_method.sql
mysql -u root -p image_classifier < tools/æ•°æ®åº“/add_batch_cache_stats.sql
# ... å…¶ä»–è¿ç§»è„šæœ¬

# æ‰§è¡Œå·¥å…·è„šæœ¬
mysql -u root -p image_classifier < tools/æ•°æ®åº“/check_user_status.sql
```

**æ³¨æ„**ï¼šSQLè¿ç§»è„šæœ¬åº”æŒ‰æ—¶é—´é¡ºåºæ‰§è¡Œï¼Œå»ºè®®å…ˆæŸ¥çœ‹è„šæœ¬å†…å®¹äº†è§£ä¾èµ–å…³ç³»ã€‚

---

## ğŸ”„ [åŒæ­¥](./åŒæ­¥/) - æ•°æ®åŒæ­¥è„šæœ¬

åŒ…å«æœåŠ¡å™¨é—´æ•°æ®åŒæ­¥çš„è„šæœ¬ã€‚

### è„šæœ¬åˆ—è¡¨

- **`sync-images.sh`** - Imagesç›®å½•å•å‘åŒæ­¥è„šæœ¬ï¼ˆWebâ†’Appï¼‰
- **`sync-images-bidirectional.sh`** - Imagesç›®å½•åŒå‘åŒæ­¥è„šæœ¬ï¼ˆWebâ†”Appï¼‰

### ä½¿ç”¨æ–¹æ³•

```bash
# å•å‘åŒæ­¥ï¼ˆæ¨èï¼‰
bash tools/åŒæ­¥/sync-images.sh

# åŒå‘åŒæ­¥
bash tools/åŒæ­¥/sync-images-bidirectional.sh
```

**æ³¨æ„**ï¼šä½¿ç”¨å‰éœ€è¦é…ç½®SSHå…å¯†ç™»å½•å’ŒæœåŠ¡å™¨ä¿¡æ¯ã€‚

---

## ğŸ§ª [æµ‹è¯•](./æµ‹è¯•/) - æµ‹è¯•ç›¸å…³è„šæœ¬

åŒ…å«å„ç§æµ‹è¯•è„šæœ¬ã€‚

### è„šæœ¬åˆ—è¡¨

- **`test-api.sh`** - APIæ¥å£æµ‹è¯•è„šæœ¬
- **`test_create_menu.py`** - å¾®ä¿¡èœå•åˆ›å»ºæµ‹è¯•
- **`test_image_edit_v2.py`** - å›¾åƒç¼–è¾‘åŠŸèƒ½æµ‹è¯•
- **`test_menu_detailed.py`** - å¾®ä¿¡èœå•è¯¦ç»†æµ‹è¯•
- **`test_local_inference.py`** - æœ¬åœ°æ¨¡å‹æ¨ç†æµ‹è¯•

### ä½¿ç”¨æ–¹æ³•

```bash
# APIæµ‹è¯•
bash tools/æµ‹è¯•/test-api.sh

# æœ¬åœ°æ¨ç†æµ‹è¯•
python tools/æµ‹è¯•/test_local_inference.py

# å›¾åƒç¼–è¾‘æµ‹è¯•
python tools/æµ‹è¯•/test_image_edit_v2.py

# å¾®ä¿¡èœå•æµ‹è¯•
python tools/æµ‹è¯•/test_create_menu.py
```

---

## ğŸ”§ [å·¥å…·](./å·¥å…·/) - å…¶ä»–å·¥å…·è„šæœ¬

åŒ…å«æ•°æ®æŸ¥è¯¢ã€ç¼“å­˜ç®¡ç†ã€è®¤è¯å·¥å…·ã€åœ°ç†ä½ç½®æ•°æ®ç­‰å·¥å…·è„šæœ¬ã€‚

### æ•°æ®æŸ¥è¯¢å·¥å…·

- **`check_user_data.py`** - æ£€æŸ¥ç”¨æˆ·æ•°æ®ï¼ŒéªŒè¯ request_log å’Œ image_classification_cache ä¸­çš„æ•°æ®
- **`check_user_ids.py`** - æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·IDï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…æœç´¢

### ç¼“å­˜ç®¡ç†å·¥å…·

- **`delete_user_cache.py`** - åˆ é™¤æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰ç¼“å­˜æ•°æ®
- **`delete_cache_by_hash.py`** - æ ¹æ®å›¾ç‰‡å“ˆå¸Œåˆ é™¤ç‰¹å®šç¼“å­˜è®°å½•

### è®¤è¯å·¥å…·

- **`generate_password_hash.py`** - ç”Ÿæˆç®¡ç†å‘˜å¯†ç å“ˆå¸Œå€¼

### åœ°ç†ä½ç½®æ•°æ®å·¥å…·

- **`import_chinese_names.py`** - å¯¼å…¥ä¸­æ–‡åœ°åæ•°æ®
- **`supplement_chinese_names.py`** - è¡¥å……ä¸­æ–‡åœ°åæ•°æ®
- **`auto_search_chinese_names.py`** - è‡ªåŠ¨æœç´¢ä¸­æ–‡åœ°å
- **`cities_chinese_supplement.csv`** - ä¸­æ–‡åœ°åè¡¥å……æ•°æ®
- **`cities_no_chinese.tsv`** - ç¼ºå°‘ä¸­æ–‡åçš„åŸå¸‚æ•°æ®

### å…¶ä»–å·¥å…·

- **`update_menu_code.sh`** - æ›´æ–°å¾®ä¿¡èœå•ä»£ç ï¼ˆShellç‰ˆæœ¬ï¼‰
- **`update_menu_code.ps1`** - æ›´æ–°å¾®ä¿¡èœå•ä»£ç ï¼ˆPowerShellç‰ˆæœ¬ï¼‰

### ä½¿ç”¨æ–¹æ³•

#### ç¼“å­˜ç®¡ç†
```bash
# åˆ é™¤ç”¨æˆ·ç¼“å­˜
python tools/å·¥å…·/delete_user_cache.py <user_id> [--confirm]

# æ ¹æ®å“ˆå¸Œåˆ é™¤ç¼“å­˜
python tools/å·¥å…·/delete_cache_by_hash.py <image_hash> [--confirm]
```

#### æ•°æ®æŸ¥è¯¢
```bash
# æ£€æŸ¥ç”¨æˆ·æ•°æ®
python tools/å·¥å…·/check_user_data.py <user_id>

# æŸ¥è¯¢ç”¨æˆ·ID
python tools/å·¥å…·/check_user_ids.py [partial_user_id]
```

#### è®¤è¯ç®¡ç†
```bash
# ç”Ÿæˆå¯†ç å“ˆå¸Œ
python tools/å·¥å…·/generate_password_hash.py
```

#### åœ°ç†ä½ç½®æ•°æ®
```bash
# å¯¼å…¥ä¸­æ–‡åœ°å
python tools/å·¥å…·/import_chinese_names.py

# è¡¥å……ä¸­æ–‡åœ°å
python tools/å·¥å…·/supplement_chinese_names.py

# è‡ªåŠ¨æœç´¢ä¸­æ–‡åœ°å
python tools/å·¥å…·/auto_search_chinese_names.py
```

#### å¾®ä¿¡èœå•æ›´æ–°
```bash
# Shellç‰ˆæœ¬
bash tools/å·¥å…·/update_menu_code.sh

# PowerShellç‰ˆæœ¬
powershell -ExecutionPolicy Bypass -File tools/å·¥å…·/update_menu_code.ps1
```

---

## ğŸ“Š è„šæœ¬ç»Ÿè®¡

- **éƒ¨ç½²è„šæœ¬**: 4ä¸ª
- **æ•°æ®åº“è„šæœ¬**: 4ä¸ªShellè„šæœ¬ + 17ä¸ªSQLè„šæœ¬ = 21ä¸ª
- **åŒæ­¥è„šæœ¬**: 2ä¸ª
- **æµ‹è¯•è„šæœ¬**: 5ä¸ª
- **å·¥å…·è„šæœ¬**: 12ä¸ª

**æ€»è®¡**: 44ä¸ªæ–‡ä»¶ï¼ˆ27ä¸ªè„šæœ¬æ–‡ä»¶ + 17ä¸ªSQLè„šæœ¬æ–‡ä»¶ï¼‰

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**ï¼šæŸäº›è„šæœ¬éœ€è¦æ•°æ®åº“è®¿é—®æƒé™æˆ–SSHå…å¯†ç™»å½•
2. **ç¯å¢ƒé…ç½®**ï¼šç¡®ä¿å·²æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒ `env.example`ï¼‰
3. **å¤‡ä»½æ•°æ®**ï¼šæ‰§è¡Œåˆ é™¤æˆ–ä¿®æ”¹æ“ä½œå‰å»ºè®®å…ˆå¤‡ä»½é‡è¦æ•°æ®
4. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯è„šæœ¬åŠŸèƒ½
5. **è„šæœ¬è·¯å¾„**ï¼šä½¿ç”¨è„šæœ¬æ—¶æ³¨æ„è·¯å¾„ï¼Œå»ºè®®åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ

---

## ğŸ”§ ä¾èµ–è¦æ±‚

æ‰€æœ‰Pythonè„šæœ¬éƒ½ä¾èµ–äºé¡¹ç›®çš„ä¸»è¦ä¾èµ–åŒ…ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ï¼š

```bash
pip install -r requirements.txt
```

Shellè„šæœ¬éœ€è¦ï¼š
- Bash 4.0+
- SSHå®¢æˆ·ç«¯
- rsyncï¼ˆåŒæ­¥è„šæœ¬ï¼‰
- MySQLå®¢æˆ·ç«¯ï¼ˆæ•°æ®åº“è„šæœ¬ï¼‰

---

## ğŸ¯ å¿«é€Ÿå¯¼èˆª

### éƒ¨ç½²æ–°æœåŠ¡å™¨
1. ä½¿ç”¨ `éƒ¨ç½²/deploy-to-server.sh` è¿›è¡Œå®Œæ•´éƒ¨ç½²
2. ä½¿ç”¨ `æ•°æ®åº“/setup-mysql-master.sh` é…ç½®ä¸»æ•°æ®åº“
3. ä½¿ç”¨ `åŒæ­¥/sync-images.sh` åŒæ­¥æ•°æ®

### é…ç½®ä¸»ä»åŒæ­¥
1. åœ¨ä¸»æœåŠ¡å™¨è¿è¡Œ `æ•°æ®åº“/setup-mysql-master.sh`
2. åœ¨ä»æœåŠ¡å™¨è¿è¡Œ `æ•°æ®åº“/setup-mysql-slave.sh`
3. ä½¿ç”¨ `æ•°æ®åº“/export-import-database.sh` åŒæ­¥æ•°æ®

### æ—¥å¸¸ç»´æŠ¤
1. ä½¿ç”¨ `å·¥å…·/check_user_data.py` æ£€æŸ¥ç”¨æˆ·æ•°æ®
2. ä½¿ç”¨ `å·¥å…·/delete_user_cache.py` æ¸…ç†ç¼“å­˜
3. ä½¿ç”¨ `æµ‹è¯•/test-api.sh` æµ‹è¯•APIåŠŸèƒ½

---

**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: ImageClassifier Team
