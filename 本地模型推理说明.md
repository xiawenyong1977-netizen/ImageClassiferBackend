# æœ¬åœ°æ¨¡åž‹æŽ¨ç†è¯´æ˜Ž ðŸ“

## âœ… ç®€åŒ–å®Œæˆ

å·²å°†ä»£ç ç®€åŒ–ä¸ºå•ä¸€ç‰ˆæœ¬ï¼Œä½¿ç”¨ **Ultralytics** åº“è‡ªåŠ¨å¤„ç†YOLOçš„é¢„å¤„ç†å’ŒåŽå¤„ç†ã€‚

## ðŸ“¦ æ ¸å¿ƒæ–‡ä»¶

```
app/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ local_model_inference.py  # æœ¬åœ°æ¨¡åž‹æŽ¨ç†æœåŠ¡ï¼ˆä½¿ç”¨Ultralyticsï¼‰
â””â”€â”€ api/
    â””â”€â”€ local_classify.py          # æœ¬åœ°åˆ†ç±»APIæŽ¥å£
```

## ðŸš€ å¿«é€Ÿä½¿ç”¨

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- **ultralytics** - YOLOæŽ¨ç†åº“ï¼ˆè‡ªåŠ¨é¢„å¤„ç†/åŽå¤„ç†ï¼‰
- **onnxruntime** - ONNXæ¨¡åž‹æŽ¨ç†
- **numpy** - æ•°å€¼è®¡ç®—
- **Pillow** - å›¾åƒå¤„ç†

### 2. åœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from app.services.local_model_inference import local_model_inference

# åˆå§‹åŒ–æ¨¡åž‹ï¼ˆé¦–æ¬¡è°ƒç”¨ï¼‰
await local_model_inference.initialize()

# æ‰§è¡ŒæŽ¨ç†
result = await local_model_inference.classify_image(image_bytes)

# æŸ¥çœ‹ç»“æžœ
print(f"åˆ†ç±»: {result['categoryId']}")
print(f"ç½®ä¿¡åº¦: {result['confidence']}")
```

### 3. APIæŽ¥å£

- `POST /api/v1/local-classify` - æœ¬åœ°æ¨¡åž‹åˆ†ç±»
- `POST /api/v1/local-classify/detailed` - è¯¦ç»†ç»“æžœ
- `GET /api/v1/local-classify/models` - æ¨¡åž‹çŠ¶æ€

## ðŸŽ¯ æ”¯æŒçš„3ä¸ªæ¨¡åž‹

1. **IDå¡è¯†åˆ«** - `id_card_detection.onnx`
2. **YOLO8sé€šç”¨æ£€æµ‹** - `yolov8s.onnx` (80ç§ç‰©ä½“)
3. **MobileNetV3åˆ†ç±»** - `mobilenetv3_rw_Opset17.onnx` (1000ç±»)

## ðŸ·ï¸ åˆ†ç±»ç»“æžœ

| åˆ†ç±»ID | è¯´æ˜Ž |
|--------|------|
| `idcard` | è¯ä»¶ç…§ |
| `single_person` | å•äººç…§ç‰‡ |
| `social_activities` | å¤šäººåˆç…§ |
| `pets` | å® ç‰© |
| `foods` | ç¾Žé£Ÿ |
| `travel_scenery` | é£Žæ™¯ |
| `screenshot` | æˆªå›¾ï¼ˆå®¢æˆ·ç«¯è¯†åˆ«ï¼‰ |
| `other` | å…¶å®ƒ |

## âš ï¸ é‡è¦è¯´æ˜Ž

### æ‰‹æœºæˆªå›¾è¯†åˆ«

**æ‰‹æœºæˆªå›¾åº”åœ¨å®¢æˆ·ç«¯è¯†åˆ«**ï¼Œå› ä¸ºï¼š
- æœåŠ¡å™¨æ”¶åˆ°çš„å›¾ç‰‡å·²ç»è¿‡ç¼©æ”¾å¤„ç†
- å®½é«˜æ¯”ä¿¡æ¯å·²å¤±çœŸ
- å®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸Šä¼ å‰åˆ¤æ–­å¹¶é™„å¸¦æ ‡è®°

å®¢æˆ·ç«¯å®žçŽ°ç¤ºä¾‹ï¼š
```javascript
// å®¢æˆ·ç«¯åˆ¤æ–­æˆªå›¾
const isScreenshot = (width, height) => {
  const aspectRatio = width / height;
  return aspectRatio <= 0.5;
};

// ä¸Šä¼ æ—¶é™„å¸¦æ ‡è®°
const uploadData = {
  image: imageFile,
  is_screenshot: isScreenshot(width, height)
};
```

## ðŸ“– æŠ€æœ¯ç‰¹ç‚¹

### ä¸ºä»€ä¹ˆä½¿ç”¨è¿™äº›åº“ï¼Ÿ

#### YOLOæ£€æµ‹ - Ultralytics
âœ… **ç®€åŒ–ä»£ç ** - é¢„å¤„ç†/åŽå¤„ç†/NMSå…¨è‡ªåŠ¨
âœ… **æ€§èƒ½ä¼˜åŒ–** - å®˜æ–¹ä¼˜åŒ–å®žçŽ°
âœ… **æ˜“äºŽç»´æŠ¤** - æ ‡å‡†åº“ï¼Œæ–‡æ¡£å®Œå–„

#### MobileNetV3é¢„å¤„ç† - torchvision.transforms
âœ… **æ ‡å‡†åŒ–** - PyTorchå®˜æ–¹é¢„å¤„ç†åº“
âœ… **è‡ªåŠ¨ä¼˜åŒ–** - åº•å±‚C++å®žçŽ°
âœ… **é›¶é¢å¤–ä¾èµ–** - ultralyticså·²åŒ…å«

### å¯¹æ¯”æ‰‹åŠ¨å®žçŽ°

| æ“ä½œ | æ‰‹åŠ¨å®žçŽ° | ä½¿ç”¨åº“ |
|------|---------|--------|
| YOLOé¢„å¤„ç† | ~50è¡Œä»£ç  | è‡ªåŠ¨ï¼ˆUltralyticsï¼‰|
| YOLOåŽå¤„ç† | ~80è¡Œä»£ç  | è‡ªåŠ¨ï¼ˆUltralyticsï¼‰|
| MobileNetV3é¢„å¤„ç† | ~20è¡Œä»£ç  | 3è¡Œï¼ˆtorchvisionï¼‰|
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½Ž |
| ä»£ç æ€»é‡ | ~150è¡Œ | ~10è¡Œ âœ… |

## ðŸ§ª æµ‹è¯•

```bash
python test_local_inference.py
```

## ðŸ“š è¯¦ç»†æ–‡æ¡£

- ðŸ“– [è¯¦ç»†ä½¿ç”¨è¯´æ˜Ž](./æœ¬åœ°æ¨¡åž‹æŽ¨ç†ä½¿ç”¨è¯´æ˜Ž.md)
- ðŸ“– [å¿«é€Ÿå…¥é—¨æŒ‡å—](./æœ¬åœ°æ¨¡åž‹æŽ¨ç†å¿«é€Ÿå…¥é—¨.md)

---

**ç‰ˆæœ¬**: 1.0.0 (ç®€åŒ–ç‰ˆ)  
**æ›´æ–°æ—¥æœŸ**: 2025-10-11  
**æŠ€æœ¯æ ˆ**: Ultralytics + ONNX Runtime

